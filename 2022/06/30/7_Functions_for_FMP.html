<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>7) FUNCIONES DESARROLLADAS PARA EL PROYECTO | Football Match Prediction</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="7) FUNCIONES DESARROLLADAS PARA EL PROYECTO" />
<meta name="author" content="Iván Fernández Aguirre" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="En este notebook se encuentran todas las funciones utilizadas a lo largo de los distintos bloques del proyecto." />
<meta property="og:description" content="En este notebook se encuentran todas las funciones utilizadas a lo largo de los distintos bloques del proyecto." />
<link rel="canonical" href="https://faegru.github.io/FMP_UB_final_project_2022/2022/06/30/7_Functions_for_FMP.html" />
<meta property="og:url" content="https://faegru.github.io/FMP_UB_final_project_2022/2022/06/30/7_Functions_for_FMP.html" />
<meta property="og:site_name" content="Football Match Prediction" />
<meta property="og:image" content="https://faegru.github.io/FMP_UB_final_project_2022/images/N7.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-06-30T00:00:00-05:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://faegru.github.io/FMP_UB_final_project_2022/images/N7.png" />
<meta property="twitter:title" content="7) FUNCIONES DESARROLLADAS PARA EL PROYECTO" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Iván Fernández Aguirre"},"dateModified":"2022-06-30T00:00:00-05:00","datePublished":"2022-06-30T00:00:00-05:00","description":"En este notebook se encuentran todas las funciones utilizadas a lo largo de los distintos bloques del proyecto.","headline":"7) FUNCIONES DESARROLLADAS PARA EL PROYECTO","image":"https://faegru.github.io/FMP_UB_final_project_2022/images/N7.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://faegru.github.io/FMP_UB_final_project_2022/2022/06/30/7_Functions_for_FMP.html"},"url":"https://faegru.github.io/FMP_UB_final_project_2022/2022/06/30/7_Functions_for_FMP.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/FMP_UB_final_project_2022/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://faegru.github.io/FMP_UB_final_project_2022/feed.xml" title="Football Match Prediction" /><link rel="shortcut icon" type="image/x-icon" href="/FMP_UB_final_project_2022/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/FMP_UB_final_project_2022/">Football Match Prediction</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/FMP_UB_final_project_2022/about/">About Me</a><a class="page-link" href="/FMP_UB_final_project_2022/search/">Search</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">7) FUNCIONES DESARROLLADAS PARA EL PROYECTO</h1><p class="page-description">En este notebook se encuentran todas las funciones utilizadas a lo largo de los distintos bloques del proyecto.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-06-30T00:00:00-05:00" itemprop="datePublished">
        Jun 30, 2022
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Iván Fernández Aguirre</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      28 min read
    
</span></p>

    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/Faegru/FMP_UB_final_project_2022/tree/master/_notebooks/2022-06-30-7_Functions_for_FMP.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/FMP_UB_final_project_2022/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          
          
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#FUNCIONES-GENERALES">FUNCIONES GENERALES </a></li>
<li class="toc-entry toc-h2"><a href="#VISULAIZACIÓN-Y-EXPLORACIÓN-DEL-DATASET">VISULAIZACIÓN Y EXPLORACIÓN DEL DATASET </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Distribuciones-de-probabilidad-e-histogramas">Distribuciones de probabilidad e histogramas </a></li>
<li class="toc-entry toc-h3"><a href="#Matrices-de-correlación">Matrices de correlación </a></li>
<li class="toc-entry toc-h3"><a href="#Otros">Otros </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#TRANSFORMACIÓN-DEL-DATASET-PARA-LOS-MODELOS">TRANSFORMACIÓN DEL DATASET PARA LOS MODELOS </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Balance-de-targets">Balance de targets </a></li>
<li class="toc-entry toc-h3"><a href="#Separación-del-Dataset-en-train-y-test">Separación del Dataset en train y test </a></li>
<li class="toc-entry toc-h3"><a href="#Transformación-y-estandarización-para-cada-modelo">Transformación y estandarización para cada modelo </a></li>
<li class="toc-entry toc-h3"><a href="#Principal-component-analysis">Principal component analysis </a></li>
<li class="toc-entry toc-h3"><a href="#Others">Others </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#MODELOS">MODELOS </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Random-Forest">Random Forest </a></li>
<li class="toc-entry toc-h3"><a href="#Red-Neuronal-Densa">Red Neuronal Densa </a></li>
<li class="toc-entry toc-h3"><a href="#Modelo-Red-Recurrente-Simple">Modelo Red Recurrente Simple </a></li>
<li class="toc-entry toc-h3"><a href="#Modelo-Red-Recurrente-Long-short-term-memory-(LSTM)">Modelo Red Recurrente Long short-term memory (LSTM) </a></li>
<li class="toc-entry toc-h3"><a href="#Modelo-Mixto-(RNN-+-Denso)">Modelo Mixto (RNN + Denso) </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#ANALISIS-DE-LOS-RESULTADOS-DE-LOS-MODELOS">ANALISIS DE LOS RESULTADOS DE LOS MODELOS </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Métricas">Métricas </a></li>
<li class="toc-entry toc-h3"><a href="#Tablas-de-Reporte">Tablas de Reporte </a></li>
<li class="toc-entry toc-h3"><a href="#Otros">Otros </a></li>
<li class="toc-entry toc-h3"><a href="#Auxiliar">Auxiliar </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-06-30-7_Functions_for_FMP.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="FUNCIONES-GENERALES">
<a class="anchor" href="#FUNCIONES-GENERALES" aria-hidden="true"><span class="octicon octicon-link"></span></a>FUNCIONES GENERALES<a class="anchor-link" href="#FUNCIONES-GENERALES"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>  
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">rename_columns</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span><span class="n">List</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Cambia nombre de columnas de un Dataframe</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DF: DataFrame</span>
<span class="sd">        List: Lista con nombres de columnas</span>
<span class="sd">    '''</span>
    <span class="n">d</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">DF</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="n">List</span><span class="p">))</span>
    <span class="n">DF</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">check_NaNs</span><span class="p">(</span><span class="n">D</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Verifica los missing values en un Dataframe</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        D: Dataframe</span>
<span class="sd">    '''</span>
    <span class="n">l</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
    <span class="n">t</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">D</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">n</span><span class="o">=</span><span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  
        <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="n">n</span>
        <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="s1">'  Nulls: </span><span class="si">{}</span><span class="s1"> / </span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">%'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">n</span><span class="o">/</span><span class="n">l</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">total missing values: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'No hay missing values en el dataset :)'</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Print_features</span><span class="p">(</span><span class="n">DF</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Imprime por pantalla los Features del dataset FMP, hasta el nootebook 4</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DF: Dataframe</span>
<span class="sd">    '''</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Today Features</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">DF</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span> <span class="ow">not</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\d'</span><span class="p">,</span> <span class="n">c</span><span class="p">)))):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n\n</span><span class="s1">Historic Features</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">DF</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="s1">'1'</span> <span class="ow">in</span> <span class="n">c</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="s1">'0'</span> <span class="ow">in</span> <span class="n">c</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">'home'</span> <span class="ow">in</span> <span class="n">c</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="s1">'away'</span> <span class="ow">in</span> <span class="n">c</span><span class="p">))</span> <span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'home/away'</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">'i'</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Print_features_data_set_modelos</span><span class="p">(</span><span class="n">DF</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Imprime por pantalla los Features del dataset FMP, para el nootebook 5</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DF: Dataframe</span>
<span class="sd">    '''</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Today Features</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">DF</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span> <span class="ow">not</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\d'</span><span class="p">,</span> <span class="n">c</span><span class="p">)))):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n\n</span><span class="s1">Historic Features</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">DF</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="s1">'1'</span> <span class="ow">in</span> <span class="n">c</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="s1">'0'</span> <span class="ow">in</span> <span class="n">c</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">'Equipo_A'</span> <span class="ow">in</span> <span class="n">c</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="s1">'Equipo_B'</span> <span class="ow">in</span> <span class="n">c</span><span class="p">))</span> <span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'Equipo_(A/B)'</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">'i'</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="VISULAIZACIÓN-Y-EXPLORACIÓN-DEL-DATASET">
<a class="anchor" href="#VISULAIZACI%C3%93N-Y-EXPLORACI%C3%93N-DEL-DATASET" aria-hidden="true"><span class="octicon octicon-link"></span></a>VISULAIZACIÓN Y EXPLORACIÓN DEL <em>DATASET</em><a class="anchor-link" href="#VISULAIZACI%C3%93N-Y-EXPLORACI%C3%93N-DEL-DATASET"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Distribuciones-de-probabilidad-e-histogramas">
<a class="anchor" href="#Distribuciones-de-probabilidad-e-histogramas" aria-hidden="true"><span class="octicon octicon-link"></span></a>Distribuciones de probabilidad e histogramas<a class="anchor-link" href="#Distribuciones-de-probabilidad-e-histogramas"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">skellam</span><span class="p">,</span> <span class="n">norm</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Poisson_distribution</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Forma analítica de la distribución de Poisson </span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        l: Lambda</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        array transformado</span>
<span class="sd">    '''</span>
    <span class="n">fact</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">,</span> <span class="n">otypes</span><span class="o">=</span><span class="s1">'O'</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">l</span><span class="o">**</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="n">fact</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Log_normal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Forma analítica de la distribución de Log-normal</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        m: media</span>
<span class="sd">        s: desviación estandar</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        array transformado</span>
<span class="sd">    '''</span>
    <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Plot_distributions</span><span class="p">(</span><span class="n">DS</span><span class="p">,</span><span class="n">columns</span><span class="p">,</span><span class="n">rows</span><span class="p">,</span><span class="n">Features</span><span class="p">,</span><span class="n">Type</span><span class="p">,</span><span class="n">n_bin</span><span class="p">,</span><span class="n">Dist</span><span class="p">,</span><span class="n">x_label</span><span class="p">,</span><span class="n">y_label</span><span class="p">,</span><span class="n">alig</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Grafica histogramas de features de un DataFrame. Calcula: media, std, std error, skewness, entre otros.</span>
<span class="sd">    Si se propone una distribución entre las disponibles (Log-norm, Poisson, Normal, Skellam), </span>
<span class="sd">    la grafica tomando los valores del histograma.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DS: DataFrame</span>
<span class="sd">        columns: numero de columnas de la figura</span>
<span class="sd">        rows: numerod de filas de la figura</span>
<span class="sd">        Features: Lista de Features a analizar</span>
<span class="sd">        Type: tipo de dato 'historic' or 'match'</span>
<span class="sd">        n_bin: Lista con numero de bines del histograma</span>
<span class="sd">        Dist: Lista con Distribución a graficar.</span>
<span class="sd">        x_label: Lista con nombre del x label de cada subplot</span>
<span class="sd">        y_label: Lista con nombre del y label de cada subplot</span>
<span class="sd">        alig: alineacion de las barras del histograma 'mid' 'left' or 'right'</span>

<span class="sd">    '''</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">columns</span><span class="o">*</span><span class="n">rows</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">,</span><span class="n">al</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">Features</span><span class="p">,</span><span class="n">Type</span><span class="p">,</span><span class="n">n_bin</span><span class="p">,</span><span class="n">Dist</span><span class="p">,</span><span class="n">x_label</span><span class="p">,</span><span class="n">y_label</span><span class="p">,</span><span class="n">alig</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="o">==</span><span class="s1">'historic'</span><span class="p">):</span>
            <span class="n">C</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">f</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'home'</span><span class="p">,</span><span class="s1">'away'</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)]</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">t</span><span class="o">==</span><span class="s1">'match'</span><span class="p">):</span>
            <span class="n">C</span><span class="o">=</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
        <span class="n">X</span><span class="o">=</span><span class="n">DS</span><span class="p">[</span><span class="n">C</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">X</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">m</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">std</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">me</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">sk</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">me</span><span class="p">)</span><span class="o">/</span><span class="n">std</span>
        <span class="n">mx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">mn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">n</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
        <span class="n">H</span> <span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">align</span><span class="o">=</span><span class="n">al</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Unknown'</span><span class="p">):</span>
            <span class="n">textstr</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
                <span class="sa">r</span><span class="s1">'$\mu=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'max$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'min$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'$\mathrm</span><span class="si">{median}</span><span class="s1">=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'$\sigma=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'pearson skewness$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'n$=</span><span class="si">%.0f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'std error$=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">std</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">textstr</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
                <span class="sa">r</span><span class="s1">'$\mu=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'max$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'min$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'$\mathrm</span><span class="si">{median}</span><span class="s1">=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'$\sigma=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'pearson skewness$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'n$=</span><span class="si">%.0f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'std error$=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">std</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'pdf utilizada$:$ '</span><span class="o">+</span><span class="n">d</span><span class="p">))</span>
        
        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">'round'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'wheat'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">'top'</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">!=</span><span class="s1">'Unknown'</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">d</span><span class="o">==</span><span class="s1">'Poisson'</span><span class="p">):</span>
                <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">Poisson_distribution</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">m</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">d</span><span class="o">==</span><span class="s1">'Log-norm'</span><span class="p">):</span>
                <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
                <span class="n">m_l</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">std</span><span class="o">*</span><span class="mi">2</span><span class="p">)))</span>
                <span class="n">std_l</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">((</span><span class="n">std</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">Log_normal</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">m_l</span><span class="p">,</span><span class="n">std_l</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Skellam'</span><span class="p">):</span>
                <span class="n">mu1</span><span class="o">=</span><span class="p">(</span><span class="n">std</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">mu2</span><span class="o">=</span><span class="p">(</span><span class="n">std</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">skellam</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">mu1</span><span class="p">,</span><span class="n">mu2</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Normal'</span><span class="p">):</span>
                <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">std</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">yl</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'both'</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Plot_one_distribution</span><span class="p">(</span><span class="n">DS</span><span class="p">,</span><span class="n">Features</span><span class="p">,</span><span class="n">Type</span><span class="p">,</span><span class="n">n_bin</span><span class="p">,</span><span class="n">Dist</span><span class="p">,</span><span class="n">x_label</span><span class="p">,</span><span class="n">y_label</span><span class="p">,</span><span class="n">al</span><span class="p">,</span><span class="n">text_x_pos</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">)):</span>
    <span class="sd">'''</span>
<span class="sd">    Grafica el histograma para una featuree de un DataFrame. Calcula: media, std, std error, skewness, entre otros.</span>
<span class="sd">    Si se propone una distribución entre las disponibles (Log-norm, Poisson, Normal, Skellam), </span>
<span class="sd">    la grafica tomando los valores del histograma.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DS: DataFrame</span>
<span class="sd">        Feature: Feature a analizar</span>
<span class="sd">        Type: tipo de dato 'historic' or 'match'</span>
<span class="sd">        n_bin: Lista con numero de bines del histograma</span>
<span class="sd">        Dist: Lista con Distribución a graficar.</span>
<span class="sd">        x_label: Lista con nombre del x label de cada subplot</span>
<span class="sd">        y_label: Lista con nombre del y label de cada subplot</span>
<span class="sd">        al: alineacion de las barras del histograma 'mid' 'left' or 'right'</span>
<span class="sd">        text_box_pos: posicion [x,y] del cuadro de texto</span>
<span class="sd">        xlim: rango en x</span>

<span class="sd">    '''</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">C</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Features</span><span class="p">,</span><span class="n">Type</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="o">==</span><span class="s1">'historic'</span><span class="p">):</span>
            <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="o">+</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">f</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'home'</span><span class="p">,</span><span class="s1">'away'</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)]</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">t</span><span class="o">==</span><span class="s1">'match'</span><span class="p">):</span>
            <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="o">+</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
    <span class="n">X</span><span class="o">=</span><span class="n">DS</span><span class="p">[</span><span class="n">C</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">X</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">m</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">std</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">me</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">sk</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">me</span><span class="p">)</span><span class="o">/</span><span class="n">std</span>
    <span class="n">mx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">mn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">n</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
    <span class="n">H</span> <span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bin</span><span class="p">,</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">align</span><span class="o">=</span><span class="n">al</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Unknown'</span><span class="p">):</span>
        <span class="n">textstr</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
            <span class="sa">r</span><span class="s1">'$\mu=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">),</span>
            <span class="sa">r</span><span class="s1">'max$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="p">),</span>
            <span class="sa">r</span><span class="s1">'min$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="p">),</span>
            <span class="sa">r</span><span class="s1">'$\mathrm</span><span class="si">{median}</span><span class="s1">=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="p">),</span>
            <span class="sa">r</span><span class="s1">'$\sigma=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="p">),</span>
            <span class="sa">r</span><span class="s1">'pearson skewness$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="p">),</span>
            <span class="sa">r</span><span class="s1">'n$=</span><span class="si">%.0f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">),</span>
            <span class="sa">r</span><span class="s1">'std error$=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">std</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">textstr</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
            <span class="sa">r</span><span class="s1">'$\mu=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">),</span>
            <span class="sa">r</span><span class="s1">'max$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="p">),</span>
            <span class="sa">r</span><span class="s1">'min$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="p">),</span>
            <span class="sa">r</span><span class="s1">'$\mathrm</span><span class="si">{median}</span><span class="s1">=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="p">),</span>
            <span class="sa">r</span><span class="s1">'$\sigma=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="p">),</span>
            <span class="sa">r</span><span class="s1">'pearson skewness$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="p">),</span>
            <span class="sa">r</span><span class="s1">'n$=</span><span class="si">%.0f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">),</span>
            <span class="sa">r</span><span class="s1">'std error$=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">std</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="p">),</span>
            <span class="sa">r</span><span class="s1">'pdf utilizada$:$ '</span><span class="o">+</span><span class="n">Dist</span><span class="p">))</span>
    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">'round'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'wheat'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">text_x_pos</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">'top'</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Dist</span><span class="o">!=</span><span class="s1">'Unknown'</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Poisson'</span><span class="p">):</span>
            <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">Poisson_distribution</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">m</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Log-norm'</span><span class="p">):</span>
            <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">m_l</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">std</span><span class="o">*</span><span class="mi">2</span><span class="p">)))</span>
            <span class="n">std_l</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">((</span><span class="n">std</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">Log_normal</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">m_l</span><span class="p">,</span><span class="n">std_l</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Skellam'</span><span class="p">):</span>
            <span class="n">mu1</span><span class="o">=</span><span class="p">(</span><span class="n">std</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">mu2</span><span class="o">=</span><span class="p">(</span><span class="n">std</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">skellam</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">mu1</span><span class="p">,</span><span class="n">mu2</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Normal'</span><span class="p">):</span>
            <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">std</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Plot_distribution_por_Condicion_team_and_opp</span><span class="p">(</span><span class="n">DS</span><span class="p">,</span><span class="n">Features_Team</span><span class="p">,</span><span class="n">Features_Opponent</span><span class="p">,</span><span class="n">Condition</span><span class="p">,</span><span class="n">Cond_Labels</span><span class="p">,</span><span class="n">n_bin</span><span class="p">,</span><span class="n">Dist</span><span class="p">,</span><span class="n">x_label</span><span class="p">,</span><span class="n">y_label</span><span class="p">,</span><span class="n">al</span><span class="p">,</span><span class="n">Text_box_pos</span><span class="o">=</span><span class="p">[</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.7</span><span class="p">]):</span>
    <span class="sd">'''</span>
<span class="sd">    Grafica dos histogramas de una feature en función de una condicion donde sumamos datos historicos de equipos y oponentes.</span>
<span class="sd">    Calcula: media, std, std error, skewness, entre otros. Si se propone una distribución entre las disponibles (Log-norm, Poisson, Normal, Skellam), </span>
<span class="sd">    la grafica tomando los valores del histograma.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DS: DataFrame</span>
<span class="sd">        Features_team: Feature a analizar (team)</span>
<span class="sd">        Features_Opponent: Feature a analizar (historic opponent)</span>
<span class="sd">        Condition: Condicion (variable true or False) que separa los datos</span>
<span class="sd">        Condition_Labels: Que representa True y False</span>
<span class="sd">        Type: tipo de dato 'historic' or 'match'</span>
<span class="sd">        n_bin: Lista con numero de bines del histograma</span>
<span class="sd">        Dist: Lista con Distribución a graficar.</span>
<span class="sd">        x_label: Lista con nombre del x label de cada subplot</span>
<span class="sd">        y_label: Lista con nombre del y label de cada subplot</span>
<span class="sd">        al: alineacion de las barras del histograma 'mid' 'left' or 'right'</span>
<span class="sd">        text_box_pos: posicion [x,y] del cuadro de texto</span>
<span class="sd">        xlim: rango en x</span>

<span class="sd">    '''</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    
    <span class="n">Local</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">Visitante</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'home'</span><span class="p">,</span><span class="s1">'away'</span><span class="p">]:</span>
        <span class="n">C</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">Condition</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)]</span>
        <span class="n">fil</span><span class="o">=</span><span class="n">DS</span><span class="p">[</span><span class="n">C</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">fil</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">fil</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">fil</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'bool'</span><span class="p">)</span>
        <span class="n">F</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">Features_Team</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)]</span>
        <span class="n">G</span><span class="o">=</span><span class="n">DS</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">G</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">G</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="n">Local</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">Local</span><span class="p">,</span><span class="n">G</span><span class="p">[</span><span class="n">fil</span><span class="p">]))</span>
        <span class="n">Visitante</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">Visitante</span><span class="p">,</span><span class="n">G</span><span class="p">[</span><span class="o">~</span><span class="n">fil</span><span class="p">]))</span>
    
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'home'</span><span class="p">,</span><span class="s1">'away'</span><span class="p">]:</span>
        <span class="n">C</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">Condition</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)]</span>
        <span class="n">fil</span><span class="o">=</span><span class="n">DS</span><span class="p">[</span><span class="n">C</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">fil</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">fil</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">fil</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'bool'</span><span class="p">)</span>
        <span class="n">F</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">Features_Opponent</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)]</span>
        <span class="n">G</span><span class="o">=</span><span class="n">DS</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">G</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">G</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="n">Local</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">Local</span><span class="p">,</span><span class="n">G</span><span class="p">[</span><span class="o">~</span><span class="n">fil</span><span class="p">]))</span>
        <span class="n">Visitante</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">Visitante</span><span class="p">,</span><span class="n">G</span><span class="p">[</span><span class="n">fil</span><span class="p">]))</span>
        
    
    <span class="k">for</span> <span class="n">X</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">Local</span><span class="p">,</span><span class="n">Visitante</span><span class="p">],</span><span class="n">Cond_Labels</span><span class="p">,</span><span class="n">Text_box_pos</span><span class="p">,</span><span class="n">n_bin</span><span class="p">,[</span><span class="s1">'k'</span><span class="p">,</span><span class="s1">'r'</span><span class="p">]):</span>
        <span class="n">m</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">std</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">me</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">sk</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">me</span><span class="p">)</span><span class="o">/</span><span class="n">std</span>
        <span class="n">mx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">mn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">nn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
        <span class="n">H</span> <span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">align</span><span class="o">=</span><span class="n">al</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Unknown'</span><span class="p">):</span>
            <span class="n">textstr</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
                <span class="n">n</span><span class="p">,</span>
                <span class="sa">r</span><span class="s1">'$\mu=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'max$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'min$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'$\mathrm</span><span class="si">{median}</span><span class="s1">=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'$\sigma=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'pearson skewness$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'n$=</span><span class="si">%.0f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'std error$=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">std</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">textstr</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
                <span class="n">n</span><span class="p">,</span>
                <span class="sa">r</span><span class="s1">'$\mu=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'max$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'min$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'$\mathrm</span><span class="si">{median}</span><span class="s1">=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'$\sigma=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'pearson skewness$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'n$=</span><span class="si">%.0f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'std error$=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">std</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'pdf utilizada$:$ '</span><span class="o">+</span><span class="n">Dist</span><span class="p">))</span>
        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">'round'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'wheat'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">'top'</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Dist</span><span class="o">!=</span><span class="s1">'Unknown'</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Poisson'</span><span class="p">):</span>
                <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">Poisson_distribution</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">m</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Log-norm'</span><span class="p">):</span>
                <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
                <span class="n">m_l</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">std</span><span class="o">*</span><span class="mi">2</span><span class="p">)))</span>
                <span class="n">std_l</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">((</span><span class="n">std</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">Log_normal</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">m_l</span><span class="p">,</span><span class="n">std_l</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Skellam'</span><span class="p">):</span>
                <span class="n">mu1</span><span class="o">=</span><span class="p">(</span><span class="n">std</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">mu2</span><span class="o">=</span><span class="p">(</span><span class="n">std</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">skellam</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">mu1</span><span class="p">,</span><span class="n">mu2</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Normal'</span><span class="p">):</span>
                <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">std</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Plot_distribution_por_Condicion</span><span class="p">(</span><span class="n">DS</span><span class="p">,</span><span class="n">Feature</span><span class="p">,</span><span class="n">Condition</span><span class="p">,</span><span class="n">Cond_Labels</span><span class="p">,</span><span class="n">n_bin</span><span class="p">,</span><span class="n">Dist</span><span class="p">,</span><span class="n">x_label</span><span class="p">,</span><span class="n">y_label</span><span class="p">,</span><span class="n">al</span><span class="p">,</span><span class="n">Text_box_pos</span><span class="o">=</span><span class="p">[</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.7</span><span class="p">]):</span>
    <span class="sd">'''</span>
<span class="sd">    Grafica dos histogramas de una feature en función de una condicion. Calcula: media, std, std error, skewness, entre otros.</span>
<span class="sd">    Si se propone una distribución entre las disponibles (Log-norm, Poisson, Normal, Skellam), </span>
<span class="sd">    la grafica tomando los valores del histograma.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DS: DataFrame</span>
<span class="sd">        Features: Feature a analizar</span>
<span class="sd">        Condition: Condicion (variable true or False) que separa los datos</span>
<span class="sd">        Condition_Labels: Que representa True y False</span>
<span class="sd">        Type: tipo de dato 'historic' or 'match'</span>
<span class="sd">        n_bin: Lista con numero de bines del histograma</span>
<span class="sd">        Dist: Lista con Distribución a graficar.</span>
<span class="sd">        x_label: Lista con nombre del x label de cada subplot</span>
<span class="sd">        y_label: Lista con nombre del y label de cada subplot</span>
<span class="sd">        al: alineacion de las barras del histograma 'mid' 'left' or 'right'</span>
<span class="sd">        text_box_pos: posicion [x,y] del cuadro de texto</span>
<span class="sd">        xlim: rango en x</span>

<span class="sd">    '''</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    
    <span class="n">Local</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">Visitante</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'home'</span><span class="p">,</span><span class="s1">'away'</span><span class="p">]:</span>
        <span class="n">C</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">Condition</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)]</span>
        <span class="n">fil</span><span class="o">=</span><span class="n">DS</span><span class="p">[</span><span class="n">C</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">fil</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">fil</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">fil</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'bool'</span><span class="p">)</span>
        <span class="n">F</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">Feature</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)]</span>
        <span class="n">G</span><span class="o">=</span><span class="n">DS</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">G</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">G</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="n">Local</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">Local</span><span class="p">,</span><span class="n">G</span><span class="p">[</span><span class="n">fil</span><span class="p">]))</span>
        <span class="n">Visitante</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">Visitante</span><span class="p">,</span><span class="n">G</span><span class="p">[</span><span class="o">~</span><span class="n">fil</span><span class="p">]))</span>

    <span class="k">for</span> <span class="n">X</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">Local</span><span class="p">,</span><span class="n">Visitante</span><span class="p">],</span><span class="n">Cond_Labels</span><span class="p">,</span><span class="n">Text_box_pos</span><span class="p">,</span><span class="n">n_bin</span><span class="p">,[</span><span class="s1">'k'</span><span class="p">,</span><span class="s1">'r'</span><span class="p">]):</span>
        <span class="n">m</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">std</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">me</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">sk</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">me</span><span class="p">)</span><span class="o">/</span><span class="n">std</span>
        <span class="n">mx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">mn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">nn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
        <span class="n">H</span> <span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">align</span><span class="o">=</span><span class="n">al</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Unknown'</span><span class="p">):</span>
            <span class="n">textstr</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
                <span class="n">n</span><span class="p">,</span>
                <span class="sa">r</span><span class="s1">'$\mu=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'max$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'min$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'$\mathrm</span><span class="si">{median}</span><span class="s1">=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'$\sigma=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'pearson skewness$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'n$=</span><span class="si">%.0f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'std error$=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">std</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">textstr</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
                <span class="n">n</span><span class="p">,</span>
                <span class="sa">r</span><span class="s1">'$\mu=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'max$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'min$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'$\mathrm</span><span class="si">{median}</span><span class="s1">=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'$\sigma=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'pearson skewness$=</span><span class="si">%.2f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'n$=</span><span class="si">%.0f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'std error$=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">std</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="p">),</span>
                <span class="sa">r</span><span class="s1">'pdf utilizada$:$ '</span><span class="o">+</span><span class="n">Dist</span><span class="p">))</span>
        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">'round'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'wheat'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">'top'</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Dist</span><span class="o">!=</span><span class="s1">'Unknown'</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Poisson'</span><span class="p">):</span>
                <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">Poisson_distribution</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">m</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Log-norm'</span><span class="p">):</span>
                <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
                <span class="n">m_l</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">std</span><span class="o">*</span><span class="mi">2</span><span class="p">)))</span>
                <span class="n">std_l</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">((</span><span class="n">std</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">Log_normal</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">m_l</span><span class="p">,</span><span class="n">std_l</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Skellam'</span><span class="p">):</span>
                <span class="n">mu1</span><span class="o">=</span><span class="p">(</span><span class="n">std</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">mu2</span><span class="o">=</span><span class="p">(</span><span class="n">std</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">skellam</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">mu1</span><span class="p">,</span><span class="n">mu2</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">Dist</span><span class="o">==</span><span class="s1">'Normal'</span><span class="p">):</span>
                <span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">std</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Histograma_condicional_numerica</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span><span class="n">variable</span><span class="p">,</span><span class="n">variable_condicional</span><span class="p">,</span><span class="n">tipo_de_condición</span><span class="p">,</span><span class="n">condicion_numerica</span><span class="p">,</span><span class="n">x_label</span><span class="p">,</span><span class="n">legend_pos</span><span class="o">=</span><span class="s1">'best'</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Grafica histograma de la variable, en funcion de la condicion dada.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DF: DataFrame</span>
<span class="sd">        variable: Feature para hacer el histograma</span>
<span class="sd">        variable_condicional: feature que servirá para separar los datos</span>
<span class="sd">        tipo_de_condición: 'bool' o '&gt;&lt;_value'</span>
<span class="sd">        condicion_numerica: Condición sobre ese feature</span>
<span class="sd">        X_label: Nombre del feature del histograma</span>

<span class="sd">    '''</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mf">0.2</span> 
    <span class="k">if</span><span class="p">(</span><span class="n">tipo_de_condición</span><span class="o">==</span><span class="s1">'&gt;&lt;_value'</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">-</span><span class="n">width</span><span class="p">,</span> <span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'General  N='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DF</span><span class="p">)),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="n">DF</span><span class="p">[</span><span class="n">variable_condicional</span><span class="p">]</span><span class="o">&gt;</span><span class="n">condicion_numerica</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">variable_condicional</span><span class="o">+</span><span class="s1">' &gt; '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">condicion_numerica</span><span class="p">)</span><span class="o">+</span><span class="s1">'  N='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="n">variable_condicional</span><span class="p">]</span><span class="o">&gt;</span><span class="n">condicion_numerica</span><span class="p">)),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'navy'</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="n">width</span><span class="p">,</span> <span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="n">DF</span><span class="p">[</span><span class="n">variable_condicional</span><span class="p">]</span><span class="o">&lt;-</span><span class="n">condicion_numerica</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">variable_condicional</span><span class="o">+</span><span class="s1">' &lt; '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="n">condicion_numerica</span><span class="p">)</span><span class="o">+</span><span class="s1">'  N='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="n">variable_condicional</span><span class="p">]</span><span class="o">&lt;-</span><span class="n">condicion_numerica</span><span class="p">)),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">)</span>    
    <span class="k">elif</span><span class="p">(</span><span class="n">tipo_de_condición</span><span class="o">==</span><span class="s1">'bool'</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">-</span><span class="n">width</span><span class="p">,</span> <span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'General  N='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DF</span><span class="p">)),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="n">DF</span><span class="p">[</span><span class="n">variable_condicional</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">variable_condicional</span><span class="o">+</span><span class="s1">' = True '</span><span class="o">+</span><span class="s1">'  N='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="n">variable_condicional</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'navy'</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="n">width</span><span class="p">,</span> <span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="n">DF</span><span class="p">[</span><span class="n">variable_condicional</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">variable_condicional</span><span class="o">+</span><span class="s1">' = False '</span><span class="o">+</span><span class="s1">'  N='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="n">variable_condicional</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">)</span>    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Distribución de Resultados'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'x'</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">labelrotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_pos</span><span class="p">,</span><span class="n">framealpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span> <span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Histograma_VAR_categorica</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span><span class="n">variable</span><span class="p">,</span><span class="n">x_label</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Grafica histograma de la variable categorica</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DF: DataFrame</span>
<span class="sd">        variable: Feature para hacer el histograma</span>
<span class="sd">        X_label: Nombre del feature del histograma</span>

<span class="sd">    '''</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">'bar'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Distribución de Resultados'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'x'</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">labelrotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="c1">#plt.legend(fontsize=14)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Histograma_historic_condition_n_times</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span><span class="n">variable</span><span class="p">,</span><span class="n">variable_condicional</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">x_label</span><span class="p">,</span><span class="n">legend_pos</span><span class="o">=</span><span class="s1">'best'</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Grafica histograma de la variable, en funcion de la condicion dada.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DF: DataFrame</span>
<span class="sd">        variable: Feature para hacer el histograma</span>
<span class="sd">        variable_condicional: feature que servirá para separar los datos</span>
<span class="sd">        n: numero de veces</span>
<span class="sd">        X_label: Nombre del feature del histograma</span>

<span class="sd">    '''</span>
    
    <span class="n">aux</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DF</span><span class="p">)),</span><span class="n">index</span><span class="o">=</span><span class="n">DF</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
        <span class="n">l</span><span class="o">=</span><span class="n">variable_condicional</span><span class="o">+</span><span class="s1">'_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">aux</span><span class="o">=</span><span class="n">aux</span><span class="o">+</span><span class="n">DF</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mf">0.3</span> 
    
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'General  N='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DF</span><span class="p">)),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="n">width</span><span class="p">,</span> <span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span>  <span class="n">aux</span><span class="o">==</span><span class="n">n</span>  <span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">variable_condicional</span><span class="o">+</span><span class="s1">' is True '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s1">' veces.   N='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">aux</span><span class="o">==</span><span class="n">n</span><span class="p">)),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'navy'</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Distribución de Resultados'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'x'</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">labelrotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_pos</span><span class="p">,</span><span class="n">framealpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span> <span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Histograma_historic_2_condition_n_times</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span><span class="n">variable</span><span class="p">,</span><span class="n">tipo</span><span class="p">,</span><span class="n">variable_condicional_1</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">variable_condicional_2</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">x_label</span><span class="p">,</span><span class="n">legend_pos</span><span class="o">=</span><span class="s1">'best'</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Grafica histograma de la variable, en funcion de la condicion dada.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DF: DataFrame</span>
<span class="sd">        variable: Feature para hacer el histograma</span>
<span class="sd">        tipo: tipo de condición 'both =', 'both &gt;=', '1 &gt;= 2 &lt;='</span>
<span class="sd">        variable_condicional_1: feature que servirá para separar los datos</span>
<span class="sd">        n1: numero de veces</span>
<span class="sd">        variable_condicional_2: feature que servirá para separar los datos</span>
<span class="sd">        n2: numero de veces</span>
<span class="sd">        X_label: Nombre del feature del histograma</span>

<span class="sd">    '''</span>
    
    <span class="n">aux1</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DF</span><span class="p">)),</span><span class="n">index</span><span class="o">=</span><span class="n">DF</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
        <span class="n">l</span><span class="o">=</span><span class="n">variable_condicional_1</span><span class="o">+</span><span class="s1">'_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">aux1</span><span class="o">=</span><span class="n">aux1</span><span class="o">+</span><span class="n">DF</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span>
    
    <span class="n">aux2</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DF</span><span class="p">)),</span><span class="n">index</span><span class="o">=</span><span class="n">DF</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
        <span class="n">l</span><span class="o">=</span><span class="n">variable_condicional_2</span><span class="o">+</span><span class="s1">'_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">aux2</span><span class="o">=</span><span class="n">aux2</span><span class="o">+</span><span class="n">DF</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mf">0.3</span> 
    
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'General  N='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DF</span><span class="p">)),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">tipo</span><span class="o">==</span><span class="s1">'both ='</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="n">width</span><span class="p">,</span> <span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span>  <span class="p">(</span><span class="n">aux1</span><span class="o">==</span><span class="n">n1</span><span class="p">)</span> <span class="o">&amp;</span>  <span class="p">(</span><span class="n">aux2</span><span class="o">==</span><span class="n">n2</span><span class="p">)</span>  <span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">variable_condicional_1</span><span class="o">+</span><span class="s1">' is True '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span><span class="o">+</span><span class="s1">' veces</span><span class="se">\n</span><span class="s1">'</span><span class="o">+</span><span class="n">variable_condicional_2</span><span class="o">+</span><span class="s1">' is True '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span><span class="o">+</span><span class="s1">' veces</span><span class="se">\n</span><span class="s1">'</span><span class="o">+</span>   <span class="s1">'N='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">aux1</span><span class="o">==</span><span class="n">n1</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">aux2</span><span class="o">==</span><span class="n">n2</span><span class="p">))),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'navy'</span><span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">tipo</span><span class="o">==</span><span class="s1">'both &gt;='</span><span class="p">):</span>    
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="n">width</span><span class="p">,</span> <span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span>  <span class="p">(</span><span class="n">aux1</span><span class="o">&gt;=</span><span class="n">n1</span><span class="p">)</span> <span class="o">&amp;</span>  <span class="p">(</span><span class="n">aux2</span><span class="o">&gt;=</span><span class="n">n2</span><span class="p">)</span>  <span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">variable_condicional_1</span><span class="o">+</span><span class="s1">' is True '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span><span class="o">+</span><span class="s1">' veces al menos</span><span class="se">\n</span><span class="s1">'</span><span class="o">+</span><span class="n">variable_condicional_2</span><span class="o">+</span><span class="s1">' is True '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span><span class="o">+</span><span class="s1">' veces al menos</span><span class="se">\n</span><span class="s1">'</span><span class="o">+</span>   <span class="s1">'N='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">aux1</span><span class="o">&gt;=</span><span class="n">n1</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">aux2</span><span class="o">&gt;=</span><span class="n">n2</span><span class="p">))),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'navy'</span><span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">tipo</span><span class="o">==</span><span class="s1">'1 &gt;= 2 &lt;='</span><span class="p">):</span>    
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="n">width</span><span class="p">,</span> <span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span>  <span class="p">(</span><span class="n">aux1</span><span class="o">&gt;=</span><span class="n">n1</span><span class="p">)</span> <span class="o">&amp;</span>  <span class="p">(</span><span class="n">aux2</span><span class="o">&lt;=</span><span class="n">n2</span><span class="p">)</span>  <span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">variable_condicional_1</span><span class="o">+</span><span class="s1">' is True '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span><span class="o">+</span><span class="s1">' veces al menos</span><span class="se">\n</span><span class="s1">'</span><span class="o">+</span><span class="n">variable_condicional_2</span><span class="o">+</span><span class="s1">' is True '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span><span class="o">+</span><span class="s1">' veces al menos</span><span class="se">\n</span><span class="s1">'</span><span class="o">+</span>   <span class="s1">'N='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">aux1</span><span class="o">&gt;=</span><span class="n">n1</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">aux2</span><span class="o">&lt;=</span><span class="n">n2</span><span class="p">))),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'navy'</span><span class="p">)</span>
    
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Distribución de Resultados'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'x'</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">labelrotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_pos</span><span class="p">,</span><span class="n">framealpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span> <span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Matrices-de-correlación">
<a class="anchor" href="#Matrices-de-correlaci%C3%B3n" aria-hidden="true"><span class="octicon octicon-link"></span></a>Matrices de correlación<a class="anchor-link" href="#Matrices-de-correlaci%C3%B3n"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Matrices_de_correlacion_All_Features_a_la_vez</span><span class="p">(</span><span class="n">DS</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Genera matrices de correlacion para todas las features del dataset.</span>
<span class="sd">    Las referentes al partido a modelar, las agrupa en un solo subplot.</span>
<span class="sd">    Para las históricas, se genera un subplot para cada una.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DS: DataFrame</span>
<span class="sd">        </span>
<span class="sd">    '''</span>
    <span class="n">n_DS</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">DS</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'target'</span><span class="p">])</span>
    <span class="n">Lista</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">n_DS</span><span class="o">.</span><span class="n">columns</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="s1">'Victoria visitante'</span><span class="p">,</span><span class="s1">'Empate'</span><span class="p">,</span><span class="s1">'Victoria local'</span><span class="p">]</span>
    <span class="n">rename_columns</span><span class="p">(</span><span class="n">n_DS</span><span class="p">,</span><span class="n">Lista</span><span class="p">)</span>
 
    <span class="n">Match_day_features</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">n_DS</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">c</span><span class="o">!=</span><span class="s1">'id'</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\d'</span><span class="p">,</span> <span class="n">c</span><span class="p">)))):</span>
            <span class="n">Match_day_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">corrMatrix_matchday</span> <span class="o">=</span><span class="n">n_DS</span><span class="p">[</span><span class="n">Match_day_features</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
    
    <span class="n">M</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">Features</span><span class="o">=</span><span class="p">[</span><span class="s1">'goal_diff'</span><span class="p">,</span><span class="s1">'rating_diff'</span><span class="p">,</span><span class="s1">'coach_continuity'</span><span class="p">,</span><span class="s1">'team_history_is_play_home'</span><span class="p">,</span><span class="s1">'team_history_is_cup'</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">Features</span><span class="p">:</span>
        <span class="n">Col</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'home'</span><span class="p">,</span><span class="s1">'away'</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
                <span class="n">c</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">f</span><span class="o">+</span><span class="s1">'_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">Col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">Col</span><span class="o">=</span><span class="n">Col</span><span class="o">+</span><span class="p">[</span><span class="s1">'Victoria visitante'</span><span class="p">,</span><span class="s1">'Empate'</span><span class="p">,</span><span class="s1">'Victoria local'</span><span class="p">]</span>
        <span class="n">M</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">=</span><span class="n">n_DS</span><span class="p">[</span><span class="n">Col</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
    
    
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">axes</span><span class="p">,(</span><span class="mi">6</span><span class="p">,))</span>
    
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$sign(M)\,\sqrt{abs(M)}$'</span><span class="o">+</span><span class="s1">', siendo M la matriz de correlacion para las variables del partido</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">corrMatrix_matchday</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">corrMatrix_matchday</span><span class="p">)),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">"vlag"</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">Features</span><span class="p">):</span>
        <span class="n">a</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$sign(M)\,\sqrt{abs(M)}$'</span><span class="o">+</span><span class="s1">', siendo M la matriz de correlacion para las variables "</span><span class="si">{}</span><span class="s1">"</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'_'</span><span class="p">,</span> <span class="s1">' '</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">f</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">f</span><span class="p">])),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a</span> <span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">"vlag"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Matrices_de_correlacion_All_Features</span><span class="p">(</span><span class="n">DS</span><span class="p">,</span><span class="n">tipo</span><span class="p">,</span><span class="n">historic_feature</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Genera una matriz de correlacion para las features seleccionadas. </span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DS: DataFrame</span>
<span class="sd">        tipo: 'Match_day_Features' para las del partido a modelar, o 'Historicas' para una feature historica</span>
<span class="sd">        historic_feature: nombre de la feature cuando es de categoria 'Historicas'</span>
<span class="sd">        </span>
<span class="sd">    '''</span>
    
    <span class="n">n_DS</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">DS</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'target'</span><span class="p">])</span>
    <span class="n">Lista</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">n_DS</span><span class="o">.</span><span class="n">columns</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="s1">'Victoria visitante'</span><span class="p">,</span><span class="s1">'Empate'</span><span class="p">,</span><span class="s1">'Victoria local'</span><span class="p">]</span>
    <span class="n">rename_columns</span><span class="p">(</span><span class="n">n_DS</span><span class="p">,</span><span class="n">Lista</span><span class="p">)</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">tipo</span><span class="o">==</span><span class="s1">'Match_day_Features'</span><span class="p">):</span>
        <span class="n">Col</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">n_DS</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">c</span><span class="o">!=</span><span class="s1">'id'</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\d'</span><span class="p">,</span> <span class="n">c</span><span class="p">)))):</span>
                <span class="n">Col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">tipo</span><span class="o">==</span><span class="s1">'Historicas'</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">historic_feature</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'Historic feature needs to be specify as an additional argument'</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">f</span><span class="o">=</span><span class="n">historic_feature</span>
        <span class="n">Col</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'home'</span><span class="p">,</span><span class="s1">'away'</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
                <span class="n">c</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">f</span><span class="o">+</span><span class="s1">'_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">Col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">Col</span><span class="o">=</span><span class="n">Col</span><span class="o">+</span><span class="p">[</span><span class="s1">'Victoria visitante'</span><span class="p">,</span><span class="s1">'Empate'</span><span class="p">,</span><span class="s1">'Victoria local'</span><span class="p">]</span>
        
    <span class="n">M</span><span class="o">=</span><span class="n">n_DS</span><span class="p">[</span><span class="n">Col</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

    <span class="k">if</span><span class="p">(</span><span class="n">tipo</span><span class="o">==</span><span class="s1">'Match_day_Features'</span><span class="p">):</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">'del partido'</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">tipo</span><span class="o">==</span><span class="s1">'Historicas'</span><span class="p">):</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">'historicas de '</span><span class="o">+</span><span class="n">historic_feature</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'_'</span><span class="p">,</span> <span class="s1">' '</span><span class="p">)</span>
    
    <span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$sign(M)\,\sqrt{abs(M)}$'</span><span class="o">+</span><span class="s1">', siendo M la matriz de correlacion para las variables "</span><span class="si">{}</span><span class="s1">"</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">M</span><span class="p">)),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'vlag'</span> <span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Otros">
<a class="anchor" href="#Otros" aria-hidden="true"><span class="octicon octicon-link"></span></a>Otros<a class="anchor-link" href="#Otros"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Best_rating_teams</span><span class="p">(</span><span class="n">DS</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">league</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">'None'</span><span class="p">]):</span>
    <span class="sd">'''</span>
<span class="sd">    Genera una tabla (DataFrame) con los mejores N equipos de una liga, o en su defecto del dataset.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DS: DataFrame</span>
<span class="sd">        N: numero de equipos en la lista</span>
<span class="sd">        league: [id,nombre]</span>

<span class="sd">    '''</span>
    <span class="n">f</span><span class="o">=</span><span class="s1">'team_history_rating'</span>
    <span class="n">c_h</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">f</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'home'</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)]</span>
    <span class="n">C_home</span><span class="o">=</span><span class="p">[</span><span class="s1">'home_team_name'</span><span class="p">]</span><span class="o">+</span><span class="n">c_h</span>
    
    <span class="n">c_a</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">f</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'away'</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)]</span>
    <span class="n">C_away</span><span class="o">=</span><span class="p">[</span><span class="s1">'away_team_name'</span><span class="p">]</span><span class="o">+</span><span class="n">c_a</span>
    
    <span class="n">idd</span><span class="o">=</span><span class="n">league</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span><span class="p">(</span><span class="n">idd</span><span class="o">==-</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Todas las Ligas del Dataset</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
        <span class="n">DS_2</span><span class="o">=</span><span class="n">DS</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">idd</span> <span class="ow">in</span> <span class="n">DS</span><span class="o">.</span><span class="n">league_id</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Liga: '</span><span class="o">+</span><span class="n">league</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">DS_2</span><span class="o">=</span><span class="n">DS</span><span class="p">[</span><span class="n">DS</span><span class="o">.</span><span class="n">league_id</span><span class="o">==</span><span class="n">idd</span><span class="p">]</span>
        
    <span class="n">X_home</span><span class="o">=</span><span class="n">DS_2</span><span class="p">[</span><span class="n">C_home</span><span class="p">]</span>
    <span class="n">X_home</span><span class="p">[</span><span class="s1">'Rank'</span><span class="p">]</span><span class="o">=</span><span class="n">X_home</span><span class="p">[</span><span class="n">c_h</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">X_home</span><span class="o">=</span><span class="n">X_home</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">c_h</span><span class="p">)</span>

    <span class="n">X_away</span><span class="o">=</span><span class="n">DS_2</span><span class="p">[</span><span class="n">C_away</span><span class="p">]</span>
    <span class="n">X_away</span><span class="p">[</span><span class="s1">'Rank'</span><span class="p">]</span><span class="o">=</span><span class="n">X_away</span><span class="p">[</span><span class="n">c_a</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">X_away</span><span class="o">=</span><span class="n">X_away</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">c_a</span><span class="p">)</span>
    
    <span class="n">rename_columns</span><span class="p">(</span><span class="n">X_home</span><span class="p">,[</span><span class="s1">'Equipo'</span><span class="p">,</span><span class="s1">'Rating'</span><span class="p">])</span>
    <span class="n">rename_columns</span><span class="p">(</span><span class="n">X_away</span><span class="p">,[</span><span class="s1">'Equipo'</span><span class="p">,</span><span class="s1">'Rating'</span><span class="p">])</span>
    
    <span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_home</span><span class="p">,</span><span class="n">X_away</span><span class="p">])</span>

    <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'Equipo'</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    
    <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'Rating'</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="n">display</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Correlacion_X_vs_Y_his</span><span class="p">(</span><span class="n">DS</span><span class="p">,</span><span class="n">X_label</span><span class="p">,</span><span class="n">Y_label</span><span class="p">,</span><span class="n">Plot_labels</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">text_x_pos</span><span class="o">=</span><span class="mf">0.7</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Grafica el scatter plot de dos features y calcula su correlación.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DS: DataFrame</span>
<span class="sd">        X_label: Feature X</span>
<span class="sd">        Y_label: Feature Y</span>
<span class="sd">        Plot_labels= nombre de los labels [x,y]</span>
<span class="sd">        alpha: nivel de trasparencia de los puntos</span>
<span class="sd">        x_pos: posicion x del cuadro de texto donde aparece el valor de correlacion</span>

<span class="sd">    '''</span>
    <span class="n">X_c</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">xl</span> <span class="ow">in</span> <span class="n">X_label</span><span class="p">:</span>
        <span class="n">X_c</span><span class="o">=</span><span class="n">X_c</span><span class="o">+</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">xl</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'home'</span><span class="p">,</span><span class="s1">'away'</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)]</span>
    <span class="n">X</span><span class="o">=</span><span class="n">DS</span><span class="p">[</span><span class="n">X_c</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">X</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">X</span><span class="p">),))</span>
    
    <span class="n">Y_c</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">yl</span> <span class="ow">in</span> <span class="n">Y_label</span><span class="p">:</span>
        <span class="n">Y_c</span><span class="o">=</span><span class="n">Y_c</span><span class="o">+</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">yl</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'home'</span><span class="p">,</span><span class="s1">'away'</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)]</span>
    <span class="n">Y</span><span class="o">=</span><span class="n">DS</span><span class="p">[</span><span class="n">Y_c</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">Y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">Y</span><span class="p">),))</span>
    
    <span class="n">corr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">Plot_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">Plot_labels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'both'</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">textstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$Correlation\,\,Value=</span><span class="si">%.3f</span><span class="s1">$'</span> <span class="o">%</span> <span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">)</span>
    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">'round'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'wheat'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">text_x_pos</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">'top'</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'k'</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Plot_Outcome_para_copa_y_liga</span><span class="p">(</span><span class="n">DS</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Realiza un grafico de barras con los porcentages de Victoria, Empate y Derrota para partidos de: Copa, Liga y General.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DS: DataFrame</span>
<span class="sd">        </span>
<span class="sd">    '''</span>
    <span class="n">Total</span><span class="o">=</span><span class="n">DS</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">DS</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
    <span class="n">Copa</span><span class="o">=</span><span class="n">DS</span><span class="p">[</span><span class="n">DS</span><span class="o">.</span><span class="n">is_cup</span><span class="o">==</span><span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">DS</span><span class="p">[</span><span class="n">DS</span><span class="o">.</span><span class="n">is_cup</span><span class="o">==</span><span class="kc">True</span><span class="p">])</span>
    <span class="n">Liga</span><span class="o">=</span><span class="n">DS</span><span class="p">[</span><span class="n">DS</span><span class="o">.</span><span class="n">is_cup</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">DS</span><span class="p">[</span><span class="n">DS</span><span class="o">.</span><span class="n">is_cup</span><span class="o">==</span><span class="kc">False</span><span class="p">])</span>
    
    <span class="n">X</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Distribución de Resultados'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Resultado'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">X</span><span class="o">-</span><span class="mf">0.11</span><span class="p">,</span><span class="n">Total</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'General'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Liga</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'Liga'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mf">0.11</span><span class="p">,</span><span class="n">Copa</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'Copa'</span><span class="p">)</span>
    
    <span class="n">xt</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()]</span>
    <span class="n">xt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">Total</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="n">Total</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">xt</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="n">Total</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> 
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xt</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'both'</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Match_dates_histograms</span><span class="p">(</span><span class="n">DS</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Genera un histograma con las fechas de los partidos, separando partidos a modelar de los hitoricos del input.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DS: DataFrame</span>
<span class="sd">        </span>
<span class="sd">    '''</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    
    <span class="n">Feature</span><span class="o">=</span><span class="s1">'team_history_match_date'</span>
    <span class="n">C</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">Feature</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'home'</span><span class="p">,</span><span class="s1">'away'</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)]</span>
    <span class="n">X</span><span class="o">=</span><span class="n">DS</span><span class="p">[</span><span class="n">C</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">X</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="n">H</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">rename_columns</span><span class="p">(</span><span class="n">H</span><span class="p">,[</span><span class="s1">'Date'</span><span class="p">])</span>
    <span class="n">H</span><span class="o">.</span><span class="n">Date</span><span class="o">=</span><span class="n">H</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"datetime64"</span><span class="p">)</span>
    <span class="n">H</span><span class="p">[</span><span class="s1">'Year'</span><span class="p">]</span><span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
    <span class="n">H</span><span class="p">[</span><span class="s1">'Month'</span><span class="p">]</span><span class="o">=</span><span class="n">H</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
    <span class="n">Values_Historic</span><span class="o">=</span><span class="n">H</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">'Year'</span><span class="p">,</span><span class="s1">'Month'</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="n">Values_Historic</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">Values_Historic</span><span class="o">/</span><span class="n">Values_Historic</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
    <span class="n">X1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Values_Historic</span><span class="p">))</span>
    <span class="n">Y1</span><span class="o">=</span><span class="n">Values_Historic</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span><span class="n">Y1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'Partidos Historial'</span><span class="p">)</span>
    
    
    <span class="n">T</span> <span class="o">=</span> <span class="n">DS</span><span class="o">.</span><span class="n">match_date</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"datetime64"</span><span class="p">)</span>
    <span class="n">T</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="n">rename_columns</span><span class="p">(</span><span class="n">T</span><span class="p">,[</span><span class="s1">'Date'</span><span class="p">])</span>
    <span class="n">T</span><span class="p">[</span><span class="s1">'Year'</span><span class="p">]</span><span class="o">=</span><span class="n">T</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
    <span class="n">T</span><span class="p">[</span><span class="s1">'Month'</span><span class="p">]</span><span class="o">=</span><span class="n">T</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
    <span class="n">Values_Match_day</span><span class="o">=</span><span class="n">T</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">'Year'</span><span class="p">,</span><span class="s1">'Month'</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="n">Values_Match_day</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">Values_Match_day</span><span class="o">/</span><span class="n">Values_Match_day</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
    
    <span class="n">X2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Values_Match_day</span><span class="p">))</span><span class="o">+</span><span class="mi">11</span>
    <span class="n">Y2</span><span class="o">=</span><span class="n">Values_Match_day</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span><span class="n">Y2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'Partidos a Modelar'</span><span class="p">)</span>
    
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Porcentage de Partidos (%)'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Fecha'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">X1</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">X2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
    
    <span class="n">xt</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()]</span>
    <span class="n">xt</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">Values_Historic</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">xt</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">Values_Match_day</span><span class="o">.</span><span class="n">index</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'both'</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Trainer_effect_on_the_outcome</span><span class="p">(</span><span class="n">DS</span><span class="p">,</span><span class="n">dias_ventana</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Analiza el efecto de cambios de entrenadores en termino de porcentage de victorias, derrotas y empates, </span>
<span class="sd">    y el tiempo transcurrido desde dicho evento. Realiza un grafico y una tabla donde se muestran los resultados.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DS: DataFrame</span>
<span class="sd">        dias_ventana: número de dias a analizar alrrededor del cambio de entrenador</span>
<span class="sd">        </span>
<span class="sd">    '''</span>
    <span class="n">K</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">dias_ventana</span><span class="p">,</span><span class="n">dias_ventana</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="c1">#[-3,-2,-1,0,1,2,3]</span>
    <span class="n">Victorias</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">Derrotas</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">Empates</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">Muestras</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">Local</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">K</span><span class="p">:</span>
        <span class="n">C</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">D</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">V</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">L</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'home'</span><span class="p">,</span><span class="s1">'away'</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">k</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="o">-</span><span class="n">k</span><span class="p">)):</span>
                <span class="n">c</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="s1">'_coach_continuity_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">d</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="s1">'_outcome_V_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">)</span>
                <span class="n">v</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="s1">'_outcome_D_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">)</span>
                <span class="n">l</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="s1">'_team_history_is_play_home_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">C</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">C</span><span class="p">,</span><span class="n">DS</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()))</span>
                <span class="n">D</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">D</span><span class="p">,</span><span class="n">DS</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()))</span>
                <span class="n">V</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">V</span><span class="p">,</span><span class="n">DS</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()))</span>
                <span class="n">L</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">L</span><span class="p">,</span><span class="n">DS</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()))</span>
        <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">C</span><span class="o">==</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">p_v</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">C</span><span class="o">==</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">n</span>
        <span class="n">p_d</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">C</span><span class="o">==</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">n</span>
        <span class="n">p_e</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">p_d</span><span class="o">-</span><span class="n">p_v</span>
        <span class="n">p_l</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">C</span><span class="o">==</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">n</span>
        <span class="n">Victorias</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_v</span><span class="p">)</span>
        <span class="n">Empates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_e</span><span class="p">)</span>
        <span class="n">Derrotas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_d</span><span class="p">)</span>
        <span class="n">Muestras</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">Local</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_l</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
            <span class="n">p_v</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="n">n</span>
            <span class="n">p_d</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">/</span><span class="n">n</span>
            <span class="n">p_e</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">p_d</span><span class="o">-</span><span class="n">p_v</span>
            <span class="n">p_l</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">L</span><span class="p">)</span><span class="o">/</span><span class="n">n</span>
            <span class="n">Victorias</span><span class="o">=</span><span class="p">[</span><span class="n">p_v</span><span class="p">]</span><span class="o">+</span><span class="n">Victorias</span>
            <span class="n">Empates</span><span class="o">=</span><span class="p">[</span><span class="n">p_e</span><span class="p">]</span><span class="o">+</span><span class="n">Empates</span>
            <span class="n">Derrotas</span><span class="o">=</span><span class="p">[</span><span class="n">p_d</span><span class="p">]</span><span class="o">+</span><span class="n">Derrotas</span>
            <span class="n">Muestras</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">+</span><span class="n">Muestras</span>
            <span class="n">Local</span><span class="o">=</span><span class="p">[</span><span class="n">p_l</span><span class="p">]</span><span class="o">+</span><span class="n">Local</span>
    <span class="n">LABEL</span><span class="o">=</span><span class="p">[</span><span class="s1">'General'</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">K</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">LABEL</span><span class="o">=</span><span class="n">LABEL</span><span class="o">+</span><span class="p">[</span><span class="s1">'</span><span class="si">{}</span><span class="s1"> partidos antes de un cambio de entrenador'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">k</span><span class="p">))]</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">k</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">LABEL</span><span class="o">=</span><span class="n">LABEL</span><span class="o">+</span><span class="p">[</span><span class="s1">'</span><span class="si">{}</span><span class="s1"> partidos después de un cambio de entrenador'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">k</span><span class="p">))]</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">LABEL</span><span class="o">=</span><span class="n">LABEL</span><span class="o">+</span><span class="p">[</span><span class="s1">'En el partido de un cambio de entrenador'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">k</span><span class="p">))]</span>
    <span class="n">df</span><span class="o">=</span><span class="p">{</span><span class="s1">'Condición'</span><span class="p">:</span><span class="n">LABEL</span><span class="p">,</span>
        <span class="s1">'Muestras'</span><span class="p">:</span> <span class="n">Muestras</span><span class="p">,</span>
        <span class="s1">'</span><span class="si">% Lo</span><span class="s1">cal'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Local</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span>
        <span class="s1">'% Victorias'</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Victorias</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span>
        <span class="s1">'</span><span class="si">% E</span><span class="s1">mpates:'</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Empates</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span>
        <span class="s1">'% Derrotas'</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Derrotas</span><span class="p">),</span><span class="mi">2</span><span class="p">)}</span>
    <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Partidos hasta cambio de Entrenador'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Distribución de Resultados'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">Victorias</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="s1">'-o'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'% Victorias'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">Empates</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="s1">'-o'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'</span><span class="si">% E</span><span class="s1">mpates'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">Derrotas</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="s1">'-o'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'% Derrotas'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">'darkgrey'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">Victorias</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ls</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">'b'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">Empates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ls</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">Derrotas</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ls</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">'green'</span><span class="p">)</span>
    <span class="n">textstr</span> <span class="o">=</span> <span class="s1">'Las líneas punteadas indican</span><span class="se">\n</span><span class="s1">los valores en el data set completo'</span>
    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">'round'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'wheat'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">'top'</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'k'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">'size'</span><span class="p">:</span> <span class="mi">14</span><span class="p">})</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="TRANSFORMACIÓN-DEL-DATASET-PARA-LOS-MODELOS">
<a class="anchor" href="#TRANSFORMACI%C3%93N-DEL-DATASET-PARA-LOS-MODELOS" aria-hidden="true"><span class="octicon octicon-link"></span></a>TRANSFORMACIÓN DEL DATASET PARA LOS MODELOS<a class="anchor-link" href="#TRANSFORMACI%C3%93N-DEL-DATASET-PARA-LOS-MODELOS"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Balance-de-targets">
<a class="anchor" href="#Balance-de-targets" aria-hidden="true"><span class="octicon octicon-link"></span></a>Balance de targets<a class="anchor-link" href="#Balance-de-targets"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Classes_counts</span><span class="p">(</span><span class="n">DS</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Imprime por pantalla las clases en el Dataframe de target y su ocurrencia/frecuencia.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DS: DataFrame</span>
<span class="sd">        </span>
<span class="sd">    '''</span>
    <span class="n">v</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">DS</span><span class="o">.</span><span class="n">target</span><span class="p">,</span><span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">n</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">ddict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">q</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'CLASES</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ddict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">': '</span><span class="p">,</span><span class="n">ddict</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="s1">' '</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">ddict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s1">'%'</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">data_balancing_Victorias_y_Derrotas</span><span class="p">(</span><span class="n">DS</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Balancea las clases "away" y "home" a través de intercambiar visitantes y locales. Ahora pasan a llamarse Equipo 1 y</span>
<span class="sd">    Equipo 2, y la información de localía queda condensada en la variable "EqA_Local". También realiza un mezclado de las</span>
<span class="sd">    muestras.</span>
<span class="sd">    </span>
<span class="sd">    Devuelve el Dataframe resultante.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DS: DataFrame</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        DS_2: Dataframe resultante</span>
<span class="sd">    '''</span>
    <span class="c1">#This function swaps 0.5 of the home and away, and oversamples draws </span>
    <span class="c1">###################################################################</span>
    
    <span class="n">DS_2</span><span class="o">=</span><span class="n">DS</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">DS_2</span><span class="p">[</span><span class="s1">'EqA_Local'</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DS_2</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span>
    <span class="n">DS_2</span><span class="p">[</span><span class="s1">'swap'</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">DS_2</span><span class="p">))</span>
    
    <span class="n">t</span><span class="o">=</span><span class="s1">'target'</span>
    <span class="n">DS_2</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_2'</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">DS_2</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">==</span><span class="s1">'away'</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">DS_2</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">==</span><span class="s1">'home'</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span>
    
    <span class="n">c</span><span class="o">=</span><span class="s1">'swap'</span>
    
    <span class="c1">#times -1</span>
    <span class="n">Features</span><span class="o">=</span><span class="p">[</span><span class="s1">'Rating_diff'</span><span class="p">,</span><span class="s1">'diff_num_partidos_tres_semanas'</span><span class="p">,</span><span class="s1">'diff_num_partidos_diez_dias'</span><span class="p">,</span><span class="s1">'diff_num_partidos_cuatro_dias'</span><span class="p">,</span><span class="s1">'target_2'</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">Features</span><span class="p">:</span>
        <span class="n">DS_2</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">=</span><span class="n">DS_2</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">DS_2</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span><span class="o">+</span><span class="n">DS_2</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">DS_2</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1">#1 to 0 and 0 to 1</span>
    <span class="n">Features</span><span class="o">=</span><span class="p">[</span><span class="s1">'EqA_Local'</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">Features</span><span class="p">:</span>
        <span class="n">DS_2</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">=</span><span class="n">DS_2</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">DS_2</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">DS_2</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">DS_2</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span>
    
    <span class="c1">#intercambio away/home</span>
    <span class="n">Features</span><span class="o">=</span><span class="p">[</span><span class="s1">'coach_continuity'</span><span class="p">,</span><span class="s1">'partidos_tres_semanas'</span><span class="p">,</span><span class="s1">'partidos_diez_dias'</span><span class="p">,</span><span class="s1">'partidos_cuatro_dias'</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">Features</span><span class="p">:</span>
        <span class="n">h_cc</span><span class="o">=</span><span class="s1">'home_'</span><span class="o">+</span><span class="n">f</span>
        <span class="n">a_cc</span><span class="o">=</span><span class="s1">'away_'</span><span class="o">+</span><span class="n">f</span>
        <span class="n">aux_h</span><span class="o">=</span><span class="s1">'aux'</span>
    
        <span class="n">DS_2</span><span class="p">[</span><span class="n">aux_h</span><span class="p">]</span><span class="o">=</span><span class="n">DS_2</span><span class="p">[</span><span class="n">h_cc</span><span class="p">]</span>
            
        <span class="n">DS_2</span><span class="p">[</span><span class="n">h_cc</span><span class="p">]</span><span class="o">=</span><span class="n">DS_2</span><span class="p">[</span><span class="n">h_cc</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">DS_2</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">DS_2</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span><span class="o">*</span><span class="n">DS_2</span><span class="p">[</span><span class="n">a_cc</span><span class="p">]</span>

        <span class="n">DS_2</span><span class="p">[</span><span class="n">a_cc</span><span class="p">]</span><span class="o">=</span><span class="n">DS_2</span><span class="p">[</span><span class="n">a_cc</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">DS_2</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">DS_2</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span><span class="o">*</span><span class="n">DS_2</span><span class="p">[</span><span class="n">aux_h</span><span class="p">]</span>

        <span class="n">DS_2</span><span class="o">=</span><span class="n">DS_2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">aux_h</span><span class="p">])</span> 
    
    <span class="c1">#intercambio away/home</span>
    <span class="n">historic_feature</span><span class="o">=</span><span class="p">[</span><span class="s1">'goal_diff'</span><span class="p">,</span><span class="s1">'rating_diff'</span><span class="p">,</span><span class="s1">'result_ponderado'</span><span class="p">,</span><span class="s1">'coach_continuity'</span><span class="p">,</span><span class="s1">'team_history_is_play_home'</span><span class="p">,</span><span class="s1">'team_history_is_cup'</span><span class="p">,</span><span class="s1">'outcome_V'</span><span class="p">,</span><span class="s1">'outcome_D'</span><span class="p">,</span><span class="s1">'relevance'</span><span class="p">]</span>
    <span class="n">h</span><span class="o">=</span><span class="s1">'home'</span>
    <span class="n">a</span><span class="o">=</span><span class="s1">'away'</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">historic_feature</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
            <span class="n">l</span><span class="o">=</span><span class="s1">'_'</span><span class="o">+</span><span class="n">f</span><span class="o">+</span><span class="s1">'_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">aux_h</span><span class="o">=</span><span class="n">h</span><span class="o">+</span><span class="n">l</span><span class="o">+</span><span class="s1">'_aux'</span>
            
            <span class="n">DS_2</span><span class="p">[</span><span class="n">aux_h</span><span class="p">]</span><span class="o">=</span><span class="n">DS_2</span><span class="p">[</span><span class="n">h</span><span class="o">+</span><span class="n">l</span><span class="p">]</span>
            
            <span class="n">DS_2</span><span class="p">[</span><span class="n">h</span><span class="o">+</span><span class="n">l</span><span class="p">]</span><span class="o">=</span><span class="n">DS_2</span><span class="p">[</span><span class="n">h</span><span class="o">+</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">DS_2</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">DS_2</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span><span class="o">*</span><span class="n">DS_2</span><span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="n">l</span><span class="p">]</span>
            
            <span class="n">DS_2</span><span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="n">l</span><span class="p">]</span><span class="o">=</span><span class="n">DS_2</span><span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">DS_2</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">DS_2</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span><span class="o">*</span><span class="n">DS_2</span><span class="p">[</span><span class="n">aux_h</span><span class="p">]</span>
            
            <span class="n">DS_2</span><span class="o">=</span><span class="n">DS_2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">aux_h</span><span class="p">])</span> 
            
    <span class="c1">#mapear targets</span>
    <span class="n">t</span><span class="o">=</span><span class="s1">'target'</span>
    <span class="n">map_dic</span><span class="o">=</span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="s1">'EqA_Derrota'</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="s1">'EqA_Empate'</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="s1">'EqA_Victoria'</span><span class="p">}</span>
    <span class="n">DS_2</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">=</span><span class="n">DS_2</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_2'</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">map_dic</span><span class="p">)</span>
    
    <span class="c1">#cambiar nombres a eq1 y eq2</span>
    <span class="n">Names</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">DS_2</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">c2</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'home'</span><span class="p">,</span><span class="s1">'Equipo_A'</span><span class="p">)</span>
        <span class="n">c3</span><span class="o">=</span><span class="n">c2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'away'</span><span class="p">,</span><span class="s1">'Equipo_B'</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span>  <span class="s1">'team_history_is_play'</span> <span class="ow">in</span> <span class="n">c3</span>  <span class="p">):</span>
            <span class="n">c3</span><span class="o">=</span><span class="n">c3</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'team_history_is_play_Equipo_A'</span><span class="p">,</span><span class="s1">'play_home'</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span>  <span class="s1">'team_history_is_cup'</span> <span class="ow">in</span> <span class="n">c3</span>  <span class="p">):</span>
            <span class="n">c3</span><span class="o">=</span><span class="n">c3</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'team_history_is_cup'</span><span class="p">,</span><span class="s1">'is_cup'</span><span class="p">)</span>
        <span class="n">Names</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">=</span><span class="n">c3</span>
    <span class="n">DS_2</span><span class="o">=</span><span class="n">DS_2</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">Names</span><span class="p">)</span>
    
    <span class="c1">#Shufle and Reset index</span>
    <span class="n">DS_2</span> <span class="o">=</span> <span class="n">DS_2</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">#Drop columnas</span>
    <span class="n">DS_2</span><span class="o">=</span><span class="n">DS_2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'swap'</span><span class="p">,</span><span class="s1">'target_2'</span><span class="p">])</span> 
    
    <span class="c1">#print</span>
    <span class="n">display</span><span class="p">(</span><span class="n">DS_2</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">DS_2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Balance_de_empates_por_under_and_over_sampling</span><span class="p">(</span><span class="n">DS</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Balancea las clases "Empate" con Derrota y Victoria a través de realizar un oversampling de los empates y un </span>
<span class="sd">    undersampling de las derrotas y victorias. Todas las clases son afectadas porcentualmente de la misma manera. </span>
<span class="sd">    </span>
<span class="sd">    Devuelve el Dataframe resultante.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DS: DataFrame</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        DS_2: Dataframe</span>
<span class="sd">    '''</span>
    <span class="n">DS_2</span><span class="o">=</span><span class="n">DS</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># oversampling de Empate</span>
    <span class="n">v</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">DS_2</span><span class="o">.</span><span class="n">target</span><span class="p">,</span><span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ddict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">q</span><span class="p">))</span>
    <span class="n">ratio</span><span class="o">=</span><span class="p">((</span><span class="n">ddict</span><span class="p">[</span><span class="s1">'EqA_Derrota'</span><span class="p">]</span><span class="o">+</span><span class="n">ddict</span><span class="p">[</span><span class="s1">'EqA_Victoria'</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">ddict</span><span class="p">[</span><span class="s1">'EqA_Empate'</span><span class="p">]</span>
    <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">ratio</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ratio</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="c1">#proporcion a aumentar(reducir) la clase empates (victoria/derrota) para alcanzar un balance</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Ratio Victorias(Derrotas)/Empates= '</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">ratio</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Proporcion a cambiar clases= '</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s1">'%'</span><span class="p">)</span>
    
    <span class="c1">#Random selection</span>
    <span class="n">DS_2</span><span class="p">[</span><span class="s1">'resamp_idx'</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DS_2</span><span class="p">))</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">)</span>
 
    <span class="c1">#Oversampling</span>
    <span class="n">DS_2</span><span class="o">=</span><span class="n">DS_2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">DS_2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">DS_2</span><span class="o">.</span><span class="n">resamp_idx</span><span class="o">*</span><span class="p">(</span><span class="n">DS_2</span><span class="o">.</span><span class="n">target</span><span class="o">==</span><span class="s1">'EqA_Empate'</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int'</span><span class="p">))]</span>
    
    <span class="c1">#Undersampling</span>
    <span class="n">DS_2</span> <span class="o">=</span> <span class="n">DS_2</span><span class="p">[(</span><span class="n">DS_2</span><span class="o">.</span><span class="n">target</span><span class="o">==</span><span class="s1">'EqA_Empate'</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">DS_2</span><span class="o">.</span><span class="n">resamp_idx</span><span class="o">==</span><span class="mi">0</span><span class="p">)]</span>
    
    <span class="c1">#droping of auciliar feature</span>
    <span class="n">DS_2</span><span class="o">=</span><span class="n">DS_2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'resamp_idx'</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">DS_2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Separación-del-Dataset-en-train-y-test">
<a class="anchor" href="#Separaci%C3%B3n-del-Dataset-en-train-y-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Separación del <em>Dataset</em> en <em>train</em> y <em>test</em><a class="anchor-link" href="#Separaci%C3%B3n-del-Dataset-en-train-y-test"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedShuffleSplit</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">dist_of_categories</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_test</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Genera e imprime por pantalla un report del output para el trainset y el testset, mostrando las ocurrencias y</span>
<span class="sd">    distribución de clases</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        y_train: target train</span>
<span class="sd">        y_test: target test</span>
<span class="sd">    '''</span>
    <span class="n">Tabla</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">Tabla</span><span class="p">[</span><span class="s1">'train'</span><span class="p">]</span><span class="o">=</span><span class="n">y_train</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">Tabla</span><span class="p">[</span><span class="s1">'train %'</span><span class="p">]</span><span class="o">=</span><span class="n">y_train</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
    <span class="n">Tabla</span><span class="p">[</span><span class="s1">'test'</span><span class="p">]</span><span class="o">=</span><span class="n">y_test</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">Tabla</span><span class="p">[</span><span class="s1">'test %'</span><span class="p">]</span><span class="o">=</span><span class="n">y_test</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
    <span class="n">Tabla</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Tabla</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Tabla</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Training_Test_separation</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span><span class="n">print_report</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Separa el dataframe en test y train</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DS: DataFrame</span>
<span class="sd">        print_report: si es "True" imprime un reporte de ambos datasets</span>
<span class="sd">        size: tamaño del testset</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        TRAIN: train dataset</span>
<span class="sd">        TEST: test dataset</span>
<span class="sd">    '''</span>
    <span class="n">X</span><span class="o">=</span><span class="n">DF</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'target'</span><span class="p">])</span>
    <span class="n">y</span><span class="o">=</span><span class="n">DF</span><span class="o">.</span><span class="n">target</span>
    
    <span class="n">sss</span> <span class="o">=</span> <span class="n">StratifiedShuffleSplit</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">sss</span><span class="o">.</span><span class="n">get_n_splits</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">sss</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"TRAIN:"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_index</span><span class="p">),</span> <span class="s2">"TEST:"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_index</span><span class="p">))</span>
        <span class="n">TRAIN</span><span class="o">=</span><span class="n">DF</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">]</span>
        <span class="n">TEST</span><span class="o">=</span><span class="n">DF</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span><span class="n">print_report</span><span class="p">):</span>
            <span class="n">dist_of_categories</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">train_index</span><span class="p">]),</span><span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">test_index</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">TRAIN</span><span class="p">,</span><span class="n">TEST</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Split_input_and_OHE_output</span><span class="p">(</span><span class="n">DS_train</span><span class="p">,</span><span class="n">DS_test</span><span class="p">,</span><span class="n">print_report</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Separa los train y test datasets en input y output, realizando un one-hot encoding en el segundo</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DS_train: Dataset train</span>
<span class="sd">        DS_test: Dataset test</span>
<span class="sd">        print_report: si es "True" imprime un reporte sobre los outputs</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        X_train: train dataset input</span>
<span class="sd">        y_train: target train</span>
<span class="sd">        X_test: test dataset input</span>
<span class="sd">        y_test: target test</span>
<span class="sd">    '''</span>
    
    <span class="n">X_train</span><span class="o">=</span><span class="n">DS_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'target'</span><span class="p">])</span>
    <span class="n">y_train</span><span class="o">=</span><span class="n">DS_train</span><span class="o">.</span><span class="n">target</span>
    
    <span class="n">X_test</span><span class="o">=</span><span class="n">DS_test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'target'</span><span class="p">])</span>
    <span class="n">y_test</span><span class="o">=</span><span class="n">DS_test</span><span class="o">.</span><span class="n">target</span>
    
    <span class="n">y_train</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_test</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">print_report</span><span class="p">):</span>
        <span class="n">dist_of_categories</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_test</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">,</span><span class="n">X_test</span><span class="p">,</span><span class="n">y_test</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Transformación-y-estandarización-para-cada-modelo">
<a class="anchor" href="#Transformaci%C3%B3n-y-estandarizaci%C3%B3n-para-cada-modelo" aria-hidden="true"><span class="octicon octicon-link"></span></a>Transformación y estandarización para cada modelo<a class="anchor-link" href="#Transformaci%C3%B3n-y-estandarizaci%C3%B3n-para-cada-modelo"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Prepara_DF_para_Random_Forest</span><span class="p">(</span><span class="n">DF_train</span><span class="p">,</span><span class="n">DF_test</span><span class="p">,</span><span class="n">Features_His</span><span class="p">,</span><span class="n">Features_Match</span><span class="p">,</span><span class="n">Features_His_to_std</span><span class="p">,</span><span class="n">Features_Match_to_std</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Prepara y estandariza un Dataframe  para modelarlo por Random Forest</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DF: DataFrame train</span>
<span class="sd">        DF: DataFrame test</span>
<span class="sd">        Features_His: Features partidos anteriores</span>
<span class="sd">        Features_Match: Features partido a modelar</span>
<span class="sd">        Features_His_to_std: Features historicas a estandarizar</span>
<span class="sd">        Features_Match_to_std: Features del partido a estandarizar:</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        X : train input </span>
<span class="sd">        y:: train input </span>
<span class="sd">        X : test input </span>
<span class="sd">        y:: test input </span>
<span class="sd">    '''</span>
    <span class="n">y</span><span class="o">=</span><span class="n">DF_train</span><span class="o">.</span><span class="n">target</span>
    <span class="n">X</span><span class="o">=</span><span class="n">DF_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'target'</span><span class="p">,</span><span class="s1">'id'</span><span class="p">])</span>
    
    <span class="n">y_t</span><span class="o">=</span><span class="n">DF_test</span><span class="o">.</span><span class="n">target</span>
    <span class="n">X_t</span><span class="o">=</span><span class="n">DF_test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'target'</span><span class="p">,</span><span class="s1">'id'</span><span class="p">])</span>
    
    <span class="n">C</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">Features_His</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
            <span class="k">if</span><span class="p">((</span><span class="n">i</span><span class="o">!=</span><span class="mi">10</span> <span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">f</span><span class="o">!=</span><span class="s1">'coach_continuity'</span><span class="p">)):</span>
                <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="o">+</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">f</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'Equipo_A'</span><span class="p">,</span><span class="s1">'Equipo_B'</span><span class="p">]]</span>
    <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="o">+</span><span class="n">Features_Match</span>
    
    <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="n">C</span><span class="p">]</span>
    <span class="n">X_t</span><span class="o">=</span><span class="n">X_t</span><span class="p">[</span><span class="n">C</span><span class="p">]</span>
    
    <span class="n">Std_FMP</span><span class="o">=</span><span class="n">Standarizador_normal</span><span class="p">()</span>
    
    <span class="n">Cs</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">Features_His_to_std</span><span class="p">:</span>
            <span class="n">Cs</span><span class="o">=</span><span class="n">Cs</span><span class="o">+</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">f</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'Equipo_A'</span><span class="p">,</span><span class="s1">'Equipo_B'</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)]</span>
    <span class="n">Cs</span><span class="o">=</span><span class="n">Cs</span><span class="o">+</span><span class="n">Features_Match_to_std</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">C</span><span class="p">:</span>
        <span class="n">Std_FMP</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
        <span class="n">Std_FMP</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
        <span class="n">Std_FMP</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_t</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">'train'</span><span class="p">)</span>
    <span class="n">check_NaNs</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'test'</span><span class="p">)</span>
    <span class="n">check_NaNs</span><span class="p">(</span><span class="n">X_t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">X_t</span><span class="p">,</span><span class="n">y_t</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">generate_input_for_NN</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">X_test</span><span class="p">,</span><span class="n">H_Features</span><span class="p">,</span><span class="n">N_Features</span><span class="p">,</span><span class="n">oldest_match</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">standarize</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Da forma a un dataframe para servir de input de una red neuronal densa. Permite estandarizar las variables. </span>
<span class="sd">    Para las variables históricas, la standarización se hace sobre las 10 columnas de los 10 partidos todo al mismo tiempo.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        X_train: train input</span>
<span class="sd">        X_test: test input</span>
<span class="sd">        H_Features: Features historicas a considerar</span>
<span class="sd">        N_Features: Features del partido a considerar</span>
<span class="sd">        oldest_match: Numero de partidos historicos a considerar</span>
<span class="sd">        standarize: estandarizacion</span>

<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        X_train_out : train input </span>
<span class="sd">        X_test_out: test input </span>
<span class="sd">    '''</span>
    <span class="n">C</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">N_Features</span><span class="p">:</span>
        <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="o">+</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">H_Features</span><span class="p">:</span>
        <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="o">+</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">f</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'Equipo_A'</span><span class="p">,</span><span class="s1">'Equipo_B'</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">oldest_match</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">X_train_out</span><span class="o">=</span><span class="n">X_train</span><span class="p">[</span><span class="n">C</span><span class="p">]</span>
    <span class="n">X_test_out</span><span class="o">=</span><span class="n">X_test</span><span class="p">[</span><span class="n">C</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">standarize</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">S</span><span class="o">=</span><span class="n">Standarizador</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">H_Features</span><span class="p">:</span>
            <span class="n">C</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">f</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'Equipo_A'</span><span class="p">,</span><span class="s1">'Equipo_B'</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">oldest_match</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
            <span class="n">S</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_out</span><span class="p">[</span><span class="n">C</span><span class="p">],</span><span class="n">f</span><span class="p">)</span>
            <span class="n">X_train_out</span><span class="p">[</span><span class="n">C</span><span class="p">]</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train_out</span><span class="p">[</span><span class="n">C</span><span class="p">],</span><span class="n">f</span><span class="p">)</span>
            <span class="n">X_test_out</span><span class="p">[</span><span class="n">C</span><span class="p">]</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_out</span><span class="p">[</span><span class="n">C</span><span class="p">],</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">N_Features</span><span class="p">:</span>
            <span class="n">S</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_out</span><span class="p">[</span><span class="n">f</span><span class="p">],</span><span class="n">f</span><span class="p">)</span>
            <span class="n">X_train_out</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train_out</span><span class="p">[</span><span class="n">f</span><span class="p">],</span><span class="n">f</span><span class="p">)</span>
            <span class="n">X_test_out</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_out</span><span class="p">[</span><span class="n">f</span><span class="p">],</span><span class="n">f</span><span class="p">)</span>
    
    
    
    <span class="n">X_train_out</span><span class="o">=</span><span class="n">X_train_out</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">X_test_out</span><span class="o">=</span><span class="n">X_test_out</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Train shape:'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">X_train_out</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Test shape:'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">X_test_out</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">X_train_out</span><span class="p">,</span><span class="n">X_test_out</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">generate_input_for_RNN</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">X_test</span><span class="p">,</span><span class="n">Features</span><span class="p">,</span><span class="n">Equipos</span><span class="p">,</span><span class="n">oldest_match</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">standarize</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Da forma a un dataframe para servir de input de una red neuronal recurrente. Permite estandarizar las variables. </span>
<span class="sd">    La standarización se hace sobre todas la columnas de los partidos todo al mismo tiempo.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        X_train: train input</span>
<span class="sd">        X_test: test input</span>
<span class="sd">        Features: Features historicas a considerar</span>
<span class="sd">        Equipos: Equipos a considerar (A, B, o AyB), lista</span>
<span class="sd">        oldest_match: Numero de partidos historicos a considerar</span>
<span class="sd">        standarize: estandarizacion</span>

<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        M : train input </span>
<span class="sd">        M_t: test input </span>
<span class="sd">    '''</span>
    <span class="n">X</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">X_t</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">Features</span><span class="p">:</span>
        <span class="n">C</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">f</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Equipos</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">oldest_match</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">X</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">=</span><span class="n">X_train</span><span class="p">[</span><span class="n">C</span><span class="p">]</span>
        <span class="n">X_t</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">=</span><span class="n">X_test</span><span class="p">[</span><span class="n">C</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">standarize</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">S</span><span class="o">=</span><span class="n">Standarizador</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">Features</span><span class="p">:</span>
            <span class="n">S</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">f</span><span class="p">],</span><span class="n">f</span><span class="p">)</span>
            <span class="n">X</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">f</span><span class="p">],</span><span class="n">f</span><span class="p">)</span>
            <span class="n">X_t</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_t</span><span class="p">[</span><span class="n">f</span><span class="p">],</span><span class="n">f</span><span class="p">)</span>
    <span class="n">M</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">M_t</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">oldest_match</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">L</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">L_t</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Equipos</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">Features</span><span class="p">:</span>
                <span class="n">c</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="n">f</span><span class="o">+</span><span class="s1">'_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">c</span><span class="p">])</span>
                <span class="n">L_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_t</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">c</span><span class="p">])</span>
        <span class="n">M</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
        <span class="n">M_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L_t</span><span class="p">)</span>
        
    <span class="n">M</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
    <span class="n">M_t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M_t</span><span class="p">)</span>
    
    <span class="n">M</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">M_t</span><span class="o">=</span><span class="n">M_t</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Train shape:'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Test shape:'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">M_t</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">M</span><span class="p">,</span> <span class="n">M_t</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Principal-component-analysis">
<a class="anchor" href="#Principal-component-analysis" aria-hidden="true"><span class="octicon octicon-link"></span></a>Principal component analysis<a class="anchor-link" href="#Principal-component-analysis"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">PCA_analisis</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">X_t</span><span class="p">,</span><span class="n">Action</span><span class="o">=</span><span class="s1">'Fit'</span><span class="p">,</span><span class="n">umbral</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Hace un Principal component analysis (PCA) del dataframe. Y reduce la dimensionalidad dependiendo el umbral dado</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        X: DF input</span>
<span class="sd">        Action: Fit o Fit_Transform</span>
<span class="sd">        umbral: umbral para los autovalores conservados al hacer transform</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        X_train_out : train input </span>
<span class="sd">        X_test_out: test input </span>
<span class="sd">    '''</span>
    <span class="k">if</span><span class="p">(</span><span class="n">Action</span><span class="o">==</span><span class="s1">'Fit'</span><span class="p">):</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">nf</span><span class="p">)</span>
        <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">singular_values_</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">Action</span><span class="o">==</span><span class="s1">'Fit_Transform'</span><span class="p">):</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">nf</span><span class="p">)</span>
        <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">n</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">singular_values_</span><span class="o">&gt;</span><span class="n">umbral</span><span class="p">)</span>
        <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
        <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">X_new</span><span class="o">=</span><span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">X_t_new</span><span class="o">=</span><span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X_new</span><span class="p">,</span><span class="n">X_t_new</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Others">
<a class="anchor" href="#Others" aria-hidden="true"><span class="octicon octicon-link"></span></a>Others<a class="anchor-link" href="#Others"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Standarizador_normal</span><span class="p">:</span>
    <span class="sd">'''</span>
<span class="sd">    Standarizador estandar.</span>
<span class="sd">    '''</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">std</span> <span class="o">=</span>  <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="sd">'''</span>
<span class="sd">        Calcula media y desviación standar de una feature</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            X: DataFrame input</span>
<span class="sd">            name: feature name</span>
<span class="sd">        '''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="sd">'''</span>
<span class="sd">        transforma una feature</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            X: DataFrame input</span>
<span class="sd">            name: feature name</span>
<span class="sd">            </span>
<span class="sd">        Return:</span>
<span class="sd">            transformed output</span>
<span class="sd">        '''</span>
        <span class="n">X</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="n">name</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Standarizador</span><span class="p">:</span>
    <span class="sd">'''</span>
<span class="sd">    Standarizador especial para operar sobre todas las columnas históricas de un tipo, al mismo tiempo.</span>
<span class="sd">    '''</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">std</span> <span class="o">=</span>  <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="sd">'''</span>
<span class="sd">        Calcula media y desviación standar de una feature</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            X: input</span>
<span class="sd">            name: feature name</span>
<span class="sd">        '''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="sd">'''</span>
<span class="sd">        transforma una feature</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            X: input</span>
<span class="sd">            name: feature name</span>
<span class="sd">            </span>
<span class="sd">        Return:</span>
<span class="sd">            transformed output</span>
<span class="sd">            </span>
<span class="sd">        '''</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">X</span><span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="n">name</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="MODELOS">
<a class="anchor" href="#MODELOS" aria-hidden="true"><span class="octicon octicon-link"></span></a>MODELOS<a class="anchor-link" href="#MODELOS"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>

<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">SimpleRNN</span><span class="p">,</span> <span class="n">Dropout</span> <span class="p">,</span><span class="n">concatenate</span><span class="p">,</span><span class="n">LSTM</span><span class="p">,</span> <span class="n">Reshape</span>

<span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Model</span>

<span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">losses</span><span class="p">,</span> <span class="n">optimizers</span> 

<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="kn">from</span> <span class="nn">tensorflow.keras.backend</span> <span class="kn">import</span> <span class="n">clear_session</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>

<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">clean_all_models</span><span class="p">():</span>
    <span class="sd">'''</span>
<span class="sd">    Borra todos los modelos de la memoria</span>
<span class="sd">    '''</span>
    <span class="n">clear_session</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Random-Forest">
<a class="anchor" href="#Random-Forest" aria-hidden="true"><span class="octicon octicon-link"></span></a>Random Forest<a class="anchor-link" href="#Random-Forest"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Cross_Validation_RandomForest</span><span class="p">(</span><span class="n">Grid</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
    
    <span class="sd">'''</span>
<span class="sd">    Hace un cross validation para un Random Forest</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        Grid= grid de parametros para probar</span>
<span class="sd">        X= Train input</span>
<span class="sd">        y= Train output</span>
<span class="sd">        k= orden del K-fold cross validation (numeor de splits)</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Hiper-parametros optimos</span>
<span class="sd">    '''</span>
    <span class="n">forest_clas</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    
    <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">forest_clas</span><span class="p">,</span> <span class="n">Grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="n">scoring</span><span class="o">=</span><span class="s1">'accuracy'</span><span class="p">,</span><span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    
    <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Scorer"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">scorer_</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Best Score"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"the best trained model:"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Red-Neuronal-Densa">
<a class="anchor" href="#Red-Neuronal-Densa" aria-hidden="true"><span class="octicon octicon-link"></span></a>Red Neuronal Densa<a class="anchor-link" href="#Red-Neuronal-Densa"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">create_NN</span><span class="p">(</span><span class="n">output_units</span><span class="p">,</span><span class="n">hidden_units</span><span class="p">,</span><span class="n">activation</span><span class="p">,</span><span class="n">drop_out</span><span class="p">,</span><span class="n">input_shape</span><span class="p">,</span><span class="n">met</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Crea una red neuronal densa</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        output_units: output shape</span>
<span class="sd">        hidden_units: numero de nodos en cada layer</span>
<span class="sd">        activation: lista con las funciones de activacion de las layers</span>
<span class="sd">        drop_out: lista con los dropout de las layers</span>
<span class="sd">        input_shape: tamaño del input (numero de features o columnas)</span>
<span class="sd">        met: metricas</span>

<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        model: modelo </span>
<span class="sd">    '''</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
    <span class="n">N</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hidden_units</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">h</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">hidden_units</span><span class="p">,</span><span class="n">activation</span><span class="p">,</span><span class="n">drop_out</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">input_shape</span><span class="p">,)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">a</span><span class="p">))</span>
        <span class="k">if</span><span class="p">(</span><span class="n">d</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">output_units</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'softmax'</span><span class="p">))</span>
    
    <span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
    
    <span class="n">adam</span> <span class="o">=</span> <span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">'categorical_crossentropy'</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span> <span class="n">adam</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">met</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">model</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Modelo-Red-Recurrente-Simple">
<a class="anchor" href="#Modelo-Red-Recurrente-Simple" aria-hidden="true"><span class="octicon octicon-link"></span></a>Modelo Red Recurrente Simple<a class="anchor-link" href="#Modelo-Red-Recurrente-Simple"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">create_RNN</span><span class="p">(</span><span class="n">hidden_units_RNN</span><span class="p">,</span><span class="n">hidden_units_dense_extra</span><span class="p">,</span> <span class="n">activation_dense_extra</span><span class="p">,</span><span class="n">drop_out</span><span class="p">,</span> <span class="n">output_units</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">,</span><span class="n">met</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Crea una red neuronal recurrente simple</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        hidden_units_RNN: layers recurrentes</span>
<span class="sd">        hidden_units_dense_extra: layers densas</span>
<span class="sd">        activation_dense_extra: lista con las funciones de activación de las layers densas</span>
<span class="sd">        drop_out: lista con los dropout de las layers densas</span>
<span class="sd">        output_units: dimensiones del output</span>
<span class="sd">        input_shape: (time_steps,predictors)</span>
<span class="sd">        met: metricas</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        model: modelo </span>
<span class="sd">    '''</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SimpleRNN</span><span class="p">(</span><span class="n">hidden_units_RNN</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="n">input_shape</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">recurrent_dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span> <span class="c1">#,activation=activation[0]</span>
    
    <span class="k">for</span> <span class="n">h</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">hidden_units_dense_extra</span><span class="p">,</span><span class="n">activation_dense_extra</span><span class="p">,</span><span class="n">drop_out</span><span class="p">):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">a</span><span class="p">))</span>
        <span class="k">if</span><span class="p">(</span><span class="n">d</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
            
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">output_units</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">"softmax"</span><span class="p">))</span>
    
    <span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
    
    <span class="n">adam</span> <span class="o">=</span> <span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">'categorical_crossentropy'</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="n">adam</span><span class="p">,</span><span class="n">metrics</span><span class="o">=</span><span class="n">met</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Modelo-Red-Recurrente-Long-short-term-memory-(LSTM)">
<a class="anchor" href="#Modelo-Red-Recurrente-Long-short-term-memory-(LSTM)" aria-hidden="true"><span class="octicon octicon-link"></span></a>Modelo Red Recurrente Long short-term memory (LSTM)<a class="anchor-link" href="#Modelo-Red-Recurrente-Long-short-term-memory-(LSTM)"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">create_LSTM</span><span class="p">(</span><span class="n">hidden_units_RNN</span><span class="p">,</span><span class="n">hidden_units_dense_extra</span><span class="p">,</span> <span class="n">activation_dense_extra</span><span class="p">,</span><span class="n">drop_out</span><span class="p">,</span> <span class="n">output_units</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">,</span><span class="n">met</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Crea una red neuronal recurrente Long short-term memory</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        hidden_units_RNN: layers recurrentes</span>
<span class="sd">        hidden_units_dense_extra: layers densas</span>
<span class="sd">        activation_dense_extra: lista con las funciones de activación de las layers densas</span>
<span class="sd">        drop_out: lista con los dropout de las layers densas</span>
<span class="sd">        output_units: dimensiones del output</span>
<span class="sd">        input_shape: (time_steps,predictors)</span>
<span class="sd">        met: metricas</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        model: modelo </span>
<span class="sd">    '''</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="n">hidden_units_RNN</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="n">input_shape</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">recurrent_dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span> <span class="c1">#,activation=activation[0]</span>
    
    <span class="k">for</span> <span class="n">h</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">hidden_units_dense_extra</span><span class="p">,</span><span class="n">activation_dense_extra</span><span class="p">,</span><span class="n">drop_out</span><span class="p">):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">a</span><span class="p">))</span>
        <span class="k">if</span><span class="p">(</span><span class="n">d</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
            
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">output_units</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">"softmax"</span><span class="p">))</span>
    
    <span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
    
    <span class="n">adam</span> <span class="o">=</span> <span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">'categorical_crossentropy'</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="n">adam</span><span class="p">,</span><span class="n">metrics</span><span class="o">=</span><span class="n">met</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Modelo-Mixto-(RNN-+-Denso)">
<a class="anchor" href="#Modelo-Mixto-(RNN-+-Denso)" aria-hidden="true"><span class="octicon octicon-link"></span></a>Modelo Mixto (RNN + Denso)<a class="anchor-link" href="#Modelo-Mixto-(RNN-+-Denso)"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Create_Mix_Model</span><span class="p">(</span><span class="n">tipo_RNN</span> <span class="p">,</span><span class="n">recurrent_units</span><span class="p">,</span> <span class="n">dense_units</span><span class="p">,</span><span class="n">dense_drop_out</span><span class="p">,</span> <span class="n">out_shape</span><span class="p">,</span> <span class="n">input_shape_history</span><span class="p">,</span><span class="n">input_shape_now</span><span class="p">,</span><span class="n">met</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Crea una red mixta que consta de dos capas recurrentes para tratar los datos temporales de cada equipo y una capa densa donde </span>
<span class="sd">    se ingresan los outputs de esas capas recurrentes + se agregan datos referentes al partido a modelar.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        tipo_RNN: Tipo de red recurrente LSTM o Simple</span>
<span class="sd">        recurrent_units: layers de la capa recurrente</span>
<span class="sd">        dense_units: lista de numero de nodos de la capa densa</span>
<span class="sd">        dense_drop_out: porcentage de drop out para regularizar</span>
<span class="sd">        out_shape: shape del output (target)</span>
<span class="sd">        input_shape_history: shape de los inputs de las capas recurrentes (time_steps,predictors)</span>
<span class="sd">        input_shape_now: shape de los inputs de la capa densa</span>
<span class="sd">        met: metricas a evaluar</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        model: modelo </span>
<span class="sd">    '''</span>
    
    <span class="c1"># define two sets of inputs</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">input_shape_history</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">input_shape_history</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">input_shape_now</span><span class="p">,))</span>
    
    <span class="c1"># the first branch operates on the first input</span>
    <span class="k">if</span><span class="p">(</span><span class="n">tipo_RNN</span><span class="o">==</span><span class="s1">'Simple'</span><span class="p">):</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">SimpleRNN</span><span class="p">(</span><span class="n">recurrent_units</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="n">input_shape_history</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">recurrent_dropout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">use_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">unroll</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">return_state</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">SimpleRNN</span><span class="p">(</span><span class="n">recurrent_units</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="n">input_shape_history</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">recurrent_dropout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">use_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">unroll</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">return_state</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">tipo_RNN</span><span class="o">==</span><span class="s1">'LSTM'</span><span class="p">):</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="n">recurrent_units</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="n">input_shape_history</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">recurrent_dropout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">use_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">unroll</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">return_state</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="n">recurrent_units</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="n">input_shape_history</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">recurrent_dropout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">use_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">unroll</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">return_state</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">b</span><span class="p">)</span>


    <span class="n">M1</span><span class="o">=</span><span class="n">Reshape</span><span class="p">((</span><span class="n">input_shape_history</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">recurrent_units</span><span class="p">,),</span> <span class="n">input_shape</span><span class="o">=</span><span class="n">input_shape_history</span><span class="p">)(</span><span class="n">m1</span><span class="p">)</span>
    <span class="n">M2</span><span class="o">=</span><span class="n">Reshape</span><span class="p">((</span><span class="n">input_shape_history</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">recurrent_units</span><span class="p">,),</span> <span class="n">input_shape</span><span class="o">=</span><span class="n">input_shape_history</span><span class="p">)(</span><span class="n">m2</span><span class="p">)</span>
    
    <span class="c1"># combine the output of the three branches</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">([</span><span class="n">M1</span><span class="p">,</span><span class="n">M2</span><span class="p">,</span><span class="n">c</span><span class="p">])</span>
    
    <span class="n">z</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">dense_units</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">)(</span><span class="n">M</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">dense_drop_out</span><span class="p">)(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">dense_units</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">)(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">dense_drop_out</span><span class="p">)(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">dense_units</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">)(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">dense_drop_out</span><span class="p">)(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">dense_units</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">)(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">dense_drop_out</span><span class="p">)(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">dense_units</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">)(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">out_shape</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">"softmax"</span><span class="p">)(</span><span class="n">z</span><span class="p">)</span>

    
    <span class="c1"># our model will accept the inputs of the two branches and</span>
    <span class="c1"># then output a single value</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="n">outputs</span><span class="o">=</span><span class="n">z</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">'Modelo_IFA'</span><span class="p">)</span>
    
    <span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
    
    <span class="n">adam</span> <span class="o">=</span> <span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span>
    
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">'categorical_crossentropy'</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="n">adam</span><span class="p">,</span><span class="n">metrics</span><span class="o">=</span><span class="n">met</span><span class="p">)</span>
    
    
    <span class="k">return</span> <span class="n">model</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ANALISIS-DE-LOS-RESULTADOS-DE-LOS-MODELOS">
<a class="anchor" href="#ANALISIS-DE-LOS-RESULTADOS-DE-LOS-MODELOS" aria-hidden="true"><span class="octicon octicon-link"></span></a>ANALISIS DE LOS RESULTADOS DE LOS MODELOS<a class="anchor-link" href="#ANALISIS-DE-LOS-RESULTADOS-DE-LOS-MODELOS"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Métricas">
<a class="anchor" href="#M%C3%A9tricas" aria-hidden="true"><span class="octicon octicon-link"></span></a>Métricas<a class="anchor-link" href="#M%C3%A9tricas"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">compare_to_vect</span><span class="p">(</span><span class="n">y_l</span><span class="p">,</span><span class="n">y_p</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Compara target con predicción</span>
<span class="sd">    Devuelve un diccionario con el "accuracy" y otra metrica más</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        y_1: target</span>
<span class="sd">        y_p: output de probabilidades</span>

<span class="sd">    Return:</span>
<span class="sd">        R: diccionario con resultados</span>

<span class="sd">    '''</span>
    <span class="n">R</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">y2</span><span class="o">=</span><span class="n">from_prob_to_outcome</span><span class="p">(</span><span class="n">y_p</span><span class="p">)</span>
    <span class="n">y11</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_l</span><span class="p">)</span>
    <span class="n">y22</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
    <span class="n">y33</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_p</span><span class="p">)</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">l</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">y11</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">y22</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">R</span><span class="p">[</span><span class="s1">'Acc'</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="n">s</span><span class="p">,(</span><span class="n">l</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">l</span><span class="p">)</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y11</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">y33</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="c1">#s=s+np.sqrt(np.sum((y11[i]-y33[i])**2))</span>
    <span class="n">R</span><span class="p">[</span><span class="s1">'Abs_mean_distance'</span><span class="p">]</span><span class="o">=</span><span class="n">s</span><span class="o">/</span><span class="n">l</span>
    <span class="k">return</span> <span class="n">R</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Accuracy</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_p</span><span class="p">,</span><span class="n">y_t</span><span class="p">,</span><span class="n">y_t_p</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Calcula accuracy y otra metrica para el train y test, y lo imprime por pantalla</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        y: target train</span>
<span class="sd">        y_p: predicciones train</span>
<span class="sd">        y_t: target test</span>
<span class="sd">        y_t_p: predicciones test</span>

<span class="sd">    '''</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'ACCURACY</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Train:'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">compare_to_vect</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_p</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Test:'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">compare_to_vect</span><span class="p">(</span><span class="n">y_t</span><span class="p">,</span><span class="n">y_t_p</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">draw_confusion</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_p</span><span class="p">,</span><span class="n">y_t</span><span class="p">,</span><span class="n">y_t_p</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Imprime matrix de confusion</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        y: target train</span>
<span class="sd">        y_p: predicciones train</span>
<span class="sd">        y_t: target test</span>
<span class="sd">        y_t_p: predicciones test</span>

<span class="sd">    '''</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">labels_confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>    
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">title</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">yy_p</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">'Train'</span><span class="p">,</span><span class="s1">'Test'</span><span class="p">],[</span><span class="n">y</span><span class="p">,</span><span class="n">y_t</span><span class="p">],[</span><span class="n">y_p</span><span class="p">,</span><span class="n">y_t_p</span><span class="p">],</span><span class="n">axs</span><span class="p">):</span>
    
        <span class="n">y_hat</span> <span class="o">=</span> <span class="n">from_prob_to_outcome</span><span class="p">(</span><span class="n">yy_p</span><span class="p">)</span>
        <span class="n">y_hat_class</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y_hat</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">y_class</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yy</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="n">cm</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_class</span><span class="p">,</span> <span class="n">y_hat_class</span><span class="p">)</span>
         
        <span class="n">a</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
        
        <span class="n">a</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Confusion Matrix '</span><span class="o">+</span><span class="n">title</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">''</span><span class="p">]</span> <span class="o">+</span> <span class="n">labels</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">''</span><span class="p">]</span> <span class="o">+</span> <span class="n">labels</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Predicted'</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'True'</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">a</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">va</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Plot_metric_Model</span><span class="p">(</span><span class="n">history</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Plotea loss y accuracy en funcion del epoch</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        history: return del fit de modelo</span>

<span class="sd">    '''</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    
    <span class="n">metric</span><span class="o">=</span><span class="p">[</span><span class="s1">'loss'</span><span class="p">,</span><span class="s1">'accuracy'</span><span class="p">]</span>    
    <span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="s2">"upper right"</span><span class="p">,</span><span class="s2">"upper left"</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">metric</span><span class="p">,</span><span class="n">pos</span><span class="p">):</span>
        <span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="s1">'-o'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'Training data'</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">'val_'</span><span class="o">+</span><span class="n">m</span><span class="p">],</span><span class="s1">'-o'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Validation data'</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Training Evolution - '</span><span class="o">+</span><span class="n">m</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Value'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'No. epoch'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Tablas-de-Reporte">
<a class="anchor" href="#Tablas-de-Reporte" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tablas de Reporte<a class="anchor-link" href="#Tablas-de-Reporte"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Report_RF_results</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">model_name</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">X_t</span><span class="p">,</span><span class="n">y_t</span><span class="p">,</span><span class="n">Rep</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Realiza un reporte del RF</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        model: RF trained model</span>
<span class="sd">        model_name: nombre especifico de ese modelo</span>
<span class="sd">        X: train input</span>
<span class="sd">        y: train target</span>
<span class="sd">        X_t: test input</span>
<span class="sd">        y_t: test target</span>
<span class="sd">        Rep: Dict donde llenar el reporte</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Rep: Dict de reporte</span>
<span class="sd">    '''</span>
    
    <span class="n">y_p</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    
    
    
    <span class="n">Rep</span><span class="p">[</span><span class="s1">'Nombre'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_name</span><span class="o">+</span><span class="s1">' Train'</span><span class="p">)</span>
    <span class="n">Rep</span><span class="p">[</span><span class="s1">'Accuracy'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
    <span class="n">Rep</span><span class="p">[</span><span class="s1">'F1_macro'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_p</span><span class="p">,</span><span class="n">average</span><span class="o">=</span><span class="s1">'macro'</span><span class="p">))</span>
    <span class="c1">#Rep['AUC'].append(metrics.roc_auc_score(y,y_p))</span>
    
    <span class="n">y_p</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_t</span><span class="p">)</span>
    
    
    <span class="n">Rep</span><span class="p">[</span><span class="s1">'Nombre'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_name</span><span class="o">+</span><span class="s1">' Test'</span><span class="p">)</span>
    <span class="n">Rep</span><span class="p">[</span><span class="s1">'Accuracy'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_t</span><span class="p">,</span><span class="n">y_t</span><span class="p">))</span>
    <span class="n">Rep</span><span class="p">[</span><span class="s1">'F1_macro'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_t</span><span class="p">,</span><span class="n">y_p</span><span class="p">,</span><span class="n">average</span><span class="o">=</span><span class="s1">'macro'</span><span class="p">))</span>
    <span class="c1">#Rep['AUC'].append(metrics.roc_auc_score(y,y_p))</span>
    
    <span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Rep</span><span class="p">))</span>
                               
    <span class="k">return</span> <span class="n">Rep</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Print_Report</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span><span class="n">y_t</span><span class="p">,</span> <span class="n">y_t_pred</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Imprime reporte de metricas para el train y test</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        y: target train</span>
<span class="sd">        y_pred: predicciones train</span>
<span class="sd">        y_t: target test</span>
<span class="sd">        y_t_pred: predicciones test</span>

<span class="sd">    '''</span>
    <span class="n">ll</span><span class="o">=</span><span class="n">labels_confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
    <span class="n">l_train</span><span class="o">=</span><span class="p">[</span><span class="n">l</span><span class="o">+</span><span class="s1">'_train'</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">]</span>
    <span class="n">y_hat</span> <span class="o">=</span> <span class="n">from_prob_to_outcome</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
    <span class="n">Tr</span><span class="o">=</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_hat</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">target_names</span><span class="o">=</span><span class="n">l_train</span><span class="p">)</span>
    <span class="n">Tr</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Tr</span><span class="p">)</span>

    <span class="n">l_test</span><span class="o">=</span><span class="p">[</span><span class="n">l</span><span class="o">+</span><span class="s1">'_test'</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">]</span>
    <span class="n">y_hat</span> <span class="o">=</span> <span class="n">from_prob_to_outcome</span><span class="p">(</span><span class="n">y_t_pred</span><span class="p">)</span>
    <span class="n">Te</span><span class="o">=</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_t</span><span class="p">,</span><span class="n">y_hat</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">target_names</span><span class="o">=</span><span class="n">l_test</span><span class="p">)</span>
    <span class="n">Te</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Te</span><span class="p">)</span>
    
    <span class="n">display</span><span class="p">(</span><span class="n">Tr</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Te</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Append_line_to_report_table</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span><span class="n">diccionario</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">RNN</span><span class="p">,</span><span class="n">partidos</span><span class="p">,</span><span class="n">N_Features_h</span><span class="p">,</span><span class="n">N_Features_m</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Agrega una linea al reporte de resultados</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DF: DataFrame de reporte</span>
<span class="sd">        diccionario: diccionario con resultados de un modelo</span>
<span class="sd">        name: nombre del modelo al que corresponden los resultados</span>
<span class="sd">        RNN: tipo de red neuronal recurrente utilizada</span>
<span class="sd">        partidos: número de partidos considerados</span>
<span class="sd">        N_Features_h: número de variables por partido del historial consideradas</span>
<span class="sd">        N_Features_m: número de variables referentes al partido a modelar consideradas.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        DF: Reporte con la linea nueva anexada</span>
<span class="sd">    '''</span>
    <span class="n">diccionario</span><span class="p">[</span><span class="s1">'Partidos Considerados'</span><span class="p">]</span><span class="o">=</span><span class="n">partidos</span>
    <span class="n">diccionario</span><span class="p">[</span><span class="s1">'RNN'</span><span class="p">]</span><span class="o">=</span><span class="n">RNN</span>
    <span class="n">diccionario</span><span class="p">[</span><span class="s1">'N_Features_m'</span><span class="p">]</span><span class="o">=</span><span class="n">N_Features_m</span>
    <span class="n">diccionario</span><span class="p">[</span><span class="s1">'N_Features_h'</span><span class="p">]</span><span class="o">=</span><span class="n">N_Features_h</span>
    <span class="n">new_line</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">diccionario</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">name</span><span class="p">,])</span>
    <span class="n">DF</span><span class="o">=</span><span class="n">DF</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_line</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">DF</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">DF</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Append_line_to_report_table_2</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span><span class="n">diccionario</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">RNN</span><span class="p">,</span><span class="n">partidos</span><span class="p">,</span><span class="n">N_Features_h</span><span class="p">,</span><span class="n">N_Features_m</span><span class="p">,</span><span class="n">batch_size</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Agrega una linea al reporte de resultados</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DF: DataFrame de reporte</span>
<span class="sd">        diccionario: diccionario con resultados de un modelo</span>
<span class="sd">        name: nombre del modelo al que corresponden los resultados</span>
<span class="sd">        RNN: tipo de red neuronal recurrente utilizada</span>
<span class="sd">        partidos: número de partidos considerados</span>
<span class="sd">        N_Features_h: número de variables por partido del historial consideradas</span>
<span class="sd">        N_Features_m: número de variables referentes al partido a modelar consideradas.</span>
<span class="sd">        batch_size: Número de muestras que se pasan al modelo por iteración de aprendizaje</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        DF: Reporte con la linea nueva anexada</span>
<span class="sd">    '''</span>
    <span class="n">diccionario</span><span class="p">[</span><span class="s1">'Partidos Considerados'</span><span class="p">]</span><span class="o">=</span><span class="n">partidos</span>
    <span class="n">diccionario</span><span class="p">[</span><span class="s1">'RNN'</span><span class="p">]</span><span class="o">=</span><span class="n">RNN</span>
    <span class="n">diccionario</span><span class="p">[</span><span class="s1">'N_Features_m'</span><span class="p">]</span><span class="o">=</span><span class="n">N_Features_m</span>
    <span class="n">diccionario</span><span class="p">[</span><span class="s1">'N_Features_h'</span><span class="p">]</span><span class="o">=</span><span class="n">N_Features_h</span>
    <span class="n">diccionario</span><span class="p">[</span><span class="s1">'Batch_size'</span><span class="p">]</span><span class="o">=</span><span class="n">batch_size</span>
    <span class="n">new_line</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">diccionario</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">name</span><span class="p">,])</span>
    <span class="n">DF</span><span class="o">=</span><span class="n">DF</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_line</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">DF</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">DF</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">plot_report_table</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span><span class="n">columna</span><span class="p">,</span><span class="n">Y_label</span><span class="p">,</span><span class="n">RNN</span><span class="p">,</span><span class="n">N_h</span><span class="p">,</span><span class="n">N_m</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Realiza un grafico de una columna del dataframe vs un X pasado por variable</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        DF: DataFrame de reporte</span>
<span class="sd">        columna: Y del plot</span>
<span class="sd">        Y_label: nombre de Y</span>
<span class="sd">        RNN: lista de tipos de RNN a graficar</span>
<span class="sd">        N_h: lista de numero de parámetros históricos a considerar</span>
<span class="sd">        N_m: lista de numero de parámetros del partido a considerar</span>
<span class="sd">    '''</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">RNN</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">N_h</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">N_m</span><span class="p">:</span>  
                <span class="n">lab</span><span class="o">=</span><span class="s1">'Tipo de RNN: '</span><span class="o">+</span><span class="n">r</span><span class="o">+</span><span class="sa">r</span><span class="s1">',  # V x $P_h$: '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">',  # V x $P_m$: '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="s1">'Simple'</span><span class="p">):</span>
                    <span class="n">mark</span><span class="o">=</span><span class="s1">'-s'</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="s1">'LSTM'</span><span class="p">):</span>
                    <span class="n">mark</span><span class="o">=</span><span class="s1">'-o'</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="s1">'Partidos Considerados'</span><span class="p">][(</span><span class="n">DF</span><span class="p">[</span><span class="s1">'RNN'</span><span class="p">]</span><span class="o">==</span><span class="n">r</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">DF</span><span class="p">[</span><span class="s1">'N_Features_h'</span><span class="p">]</span><span class="o">==</span><span class="n">h</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="s1">'N_Features_m'</span><span class="p">]</span><span class="o">==</span><span class="n">m</span><span class="p">))],</span><span class="n">DF</span><span class="p">[</span><span class="n">columna</span><span class="p">][(</span><span class="n">DF</span><span class="p">[</span><span class="s1">'RNN'</span><span class="p">]</span><span class="o">==</span><span class="n">r</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">DF</span><span class="p">[</span><span class="s1">'N_Features_h'</span><span class="p">]</span><span class="o">==</span><span class="n">h</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="s1">'N_Features_m'</span><span class="p">]</span><span class="o">==</span><span class="n">m</span><span class="p">))],</span><span class="n">mark</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="n">lab</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Numero de partidos considerados'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Y_label</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'center left'</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Otros">
<a class="anchor" href="#Otros" aria-hidden="true"><span class="octicon octicon-link"></span></a>Otros<a class="anchor-link" href="#Otros"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="k">def</span> <span class="nf">Full_train_and_Report</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">,</span><span class="n">X_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">,</span><span class="n">batch_size</span><span class="p">,</span><span class="n">epochs</span><span class="p">,</span><span class="n">validation_split</span><span class="p">,</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">history_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">confusion_matrix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">Report_print</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Entrena un modelo y reporta el resultado</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        model: Modelo</span>
<span class="sd">        X_train: train input</span>
<span class="sd">        y_train: train target</span>
<span class="sd">        X_test: test input</span>
<span class="sd">        y_test: test target</span>
<span class="sd">        batch_size: batch size</span>
<span class="sd">        epochs: epochs</span>
<span class="sd">        validation_split: tamaño set de validacion</span>
<span class="sd">        num_classes: numero de clases en el target</span>
<span class="sd">        history_plot: bool , graficar evolucion del training</span>
<span class="sd">        confusion_matrix: bool, graficar matrix de confusion</span>
<span class="sd">        Report_print: bool, imprimir reporte de test y train</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        y_prediction_train: train prediction</span>
<span class="sd">        y_prediction_test: test prediction</span>
<span class="sd">        D: Diccionario con un reporte de resutados</span>
<span class="sd">    '''</span>
    <span class="n">cb</span><span class="o">=</span><span class="p">[</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">'val_loss'</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_delta</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)]</span>
    <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span> <span class="o">=</span> <span class="n">epochs</span> <span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span> <span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span><span class="p">,</span>  <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="n">validation_split</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">cb</span><span class="p">)</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">history_plot</span><span class="p">):</span>
        <span class="n">Plot_metric_Model</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
    
    <span class="n">y_prediction_train</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">y_prediction_test</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">):</span>
        <span class="n">draw_confusion</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_prediction_train</span><span class="p">,</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prediction_test</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">Report_print</span><span class="p">):</span>
        <span class="n">Print_Report</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_prediction_train</span><span class="p">,</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prediction_test</span><span class="p">)</span>
    
    <span class="n">D</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">metrics</span><span class="p">:</span>
        <span class="n">name</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">name</span>
        <span class="n">D</span><span class="p">[</span><span class="n">name</span><span class="o">+</span><span class="s1">' train'</span><span class="p">]</span><span class="o">=</span><span class="n">m</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_prediction_train</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">D</span><span class="p">[</span><span class="n">name</span><span class="o">+</span><span class="s1">' test'</span><span class="p">]</span><span class="o">=</span><span class="n">m</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prediction_test</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        
    <span class="k">return</span>  <span class="n">y_prediction_train</span><span class="p">,</span> <span class="n">y_prediction_test</span><span class="p">,</span><span class="n">D</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Auxiliar">
<a class="anchor" href="#Auxiliar" aria-hidden="true"><span class="octicon octicon-link"></span></a>Auxiliar<a class="anchor-link" href="#Auxiliar"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">labels_confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Genera lista de las clases del target ordenadas</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        y: target train</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        labels: lista de labels</span>
<span class="sd">    '''</span>
    <span class="n">labels</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">D</span><span class="o">=</span><span class="p">{</span><span class="s1">'EqA_Derrota'</span><span class="p">:</span><span class="s1">'Eq_B_win'</span><span class="p">,</span><span class="s1">'EqA_Empate'</span><span class="p">:</span><span class="s1">'Empate'</span><span class="p">,</span><span class="s1">'EqA_Victoria'</span><span class="p">:</span><span class="s1">'Eq_A_win'</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">labels</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">from_prob_to_outcome</span><span class="p">(</span><span class="n">y_p</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    transforma output de probabilidades en output de outcomes</span>
<span class="sd">        </span>
<span class="sd">    Arguments:</span>
<span class="sd">        y_p: output de probabilidades</span>

<span class="sd">    Return:</span>
<span class="sd">        y_outcome: output de outcomes</span>

<span class="sd">    '''</span>
    <span class="n">y_outcome</span><span class="o">=</span><span class="p">(</span><span class="n">y_p</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_p</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">y_outcome</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

</div>



  </div><a class="u-url" href="/FMP_UB_final_project_2022/2022/06/30/7_Functions_for_FMP.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/FMP_UB_final_project_2022/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
      </div>
      <div class="footer-col">
        <p>Proyecto Final del posgrado de Data Science de la UB 21/22</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/Faegru" target="_blank" title="Faegru"><svg class="svg-icon grey"><use xlink:href="/FMP_UB_final_project_2022/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/fernandez-aguirre" target="_blank" title="fernandez-aguirre"><svg class="svg-icon grey"><use xlink:href="/FMP_UB_final_project_2022/assets/minima-social-icons.svg#linkedin"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
